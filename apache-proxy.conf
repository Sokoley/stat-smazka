# Apache configuration for stat.smazka.ru
# Add this to /etc/httpd/conf/users-resources/www-root/vhost.conf
# or create a separate file and include it

# Enable required modules (run once):
# a2enmod proxy proxy_http headers

# Proxy settings for Docker container
ProxyPreserveHost On
ProxyPass / http://127.0.0.1:3000/
ProxyPassReverse / http://127.0.0.1:3000/

# WebSocket support (if needed)
RewriteEngine On
RewriteCond %{HTTP:Upgrade} websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^/?(.*) ws://127.0.0.1:3000/$1 [P,L]

# Headers
RequestHeader set X-Forwarded-Proto "https"
RequestHeader set X-Real-IP %{REMOTE_ADDR}s

# Timeouts for long-running requests (parsing)
ProxyTimeout 300
