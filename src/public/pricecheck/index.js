(()=>{var{useState:H,useEffect:ze,useMemo:ue,useRef:ce}=React,{createRoot:yt}=ReactDOM,Pe=window.Chart,Ve="https://lkk.smazka.ru/apiv1/get/pps?token=gulldl9yR7XKWadO1L64&t=actual&pc=0&cm=8";var pe=[{name:"account1",client_id:"106736",api_key:"5cf6e47b-0f73-4b23-b8cd-6a097e7cd60d"},{name:"account2",client_id:"224361",api_key:"7ac7cd44-9acf-47b5-b7ca-30de0a46f5d0"},{name:"account3",client_id:"224458",api_key:"7e634373-5841-4eaf-9cef-b5afebe888ac"}],oe="/pricecheck/api",te="price_regulator_data",we=t=>{if(!t)return 0;let y=t.replace(/[^\d.,]/g,"").replace(/,/g,".").replace(/\s+/g,""),v=parseFloat(y);return isNaN(v)?0:v};var ge=t=>{if(!t)return null;try{let v=new URL(t).pathname.split("/"),C=v.indexOf("product");if(C!==-1&&v[C+1])return v[C+1];let T=v[v.length-1].match(/\d+/);return T?T[0]:null}catch{let v=t.match(/product\/(\d+)/);return v?v[1]:null}};var Y=t=>{if(!t||t.length===0)return console.error("\u274C \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0430\u043D\u0430\u043B\u0438\u0437\u0430"),{name:-1,brand:-1,link:-1,qty:-1,sum:-1};let y=-1,v=[];for(let U=0;U<t.length;U++){let _=t[U];if(!Array.isArray(_)||_.length===0)continue;let B=_.map(R=>String(R).toLowerCase().replace(/\s+/g," ").trim()),M=B.some(R=>R.includes("\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430")||R.includes("\u043D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430")),F=B.some(R=>R.includes("\u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u043E\u0432\u0430\u0440")||R.includes("\u0441\u0441\u044B\u043B\u043A\u0430")),q=B.some(R=>R.includes("\u0431\u0440\u0435\u043D\u0434")||R.includes("\u043F\u0440\u043E\u0434\u0430\u0432\u0435\u0446")),le=B.some(R=>R.includes("\u0437\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438")||R.includes("\u0448\u0442\u0443\u043A\u0438")),E=B.some(R=>R.includes("\u0437\u0430\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0430 \u0441\u0443\u043C\u043C\u0443")||R.includes("\u0441\u0443\u043C\u043C\u0430, \u20BD"));if(M&&F&&q&&le&&E){y=U,v=_,console.log(`\u2705 \u041D\u0430\u0439\u0434\u0435\u043D\u0430 \u0441\u0442\u0440\u043E\u043A\u0430 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u043E\u0432 \u043D\u0430 \u0441\u0442\u0440\u043E\u043A\u0435 ${U+1}:`,B);break}}y===-1&&(console.error("\u274C \u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0441\u0442\u0440\u043E\u043A\u0430 \u0441 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0430\u043C\u0438 \u0442\u0430\u0431\u043B\u0438\u0446\u044B"),v=t[0]||[],console.log("\u26A0\uFE0F \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u043E\u043A\u0443 \u043A\u0430\u043A \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438:",v));let C=v.map(U=>String(U).toLowerCase().replace(/\s+/g," ").trim());console.log("\u{1F50D} \u0418\u0449\u0435\u043C \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u043F\u043E \u0442\u043E\u0447\u043D\u044B\u043C \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F\u043C \u0432:",C);let z=U=>{for(let _=0;_<C.length;_++){let B=C[_];for(let M of U)if(B===M)return console.log(`\u2705 \u041D\u0430\u0439\u0434\u0435\u043D\u043E \u0442\u043E\u0447\u043D\u043E\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435: "${B}" = "${M}" \u043D\u0430 \u0438\u043D\u0434\u0435\u043A\u0441\u0435 ${_}`),_}return-1},T=z(["\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430"]),X=z(["\u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u043E\u0432\u0430\u0440"]),I=z(["\u0431\u0440\u0435\u043D\u0434"]);I===-1&&(I=z(["\u043F\u0440\u043E\u0434\u0430\u0432\u0435\u0446"]));let L=z(["\u0437\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438"]),W=z(["\u0437\u0430\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0430 \u0441\u0443\u043C\u043C\u0443, \u20BD"]);console.log("\u{1F4CA} \u041D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0435 \u0438\u043D\u0434\u0435\u043A\u0441\u044B:",{nameIdx:T,brandIdx:I,linkIdx:X,qtyIdx:L,sumIdx:W});let P=[];return T===-1&&P.push("\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430"),X===-1&&P.push("\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u043E\u0432\u0430\u0440"),I===-1&&P.push("\u0411\u0440\u0435\u043D\u0434 \u0438\u043B\u0438 \u041F\u0440\u043E\u0434\u0430\u0432\u0435\u0446"),L===-1&&P.push("\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438"),W===-1&&P.push("\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0430 \u0441\u0443\u043C\u043C\u0443, \u20BD"),P.length>0?(console.error("\u274C \u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u043A\u043E\u043B\u043E\u043D\u043A\u0438:",P),console.log("\u2139\uFE0F \u0412\u0441\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438:",C),{name:-1,brand:-1,link:-1,qty:-1,sum:-1}):(console.log("\u2705 \u0412\u0441\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u043D\u0430\u0439\u0434\u0435\u043D\u044B!"),console.log("\u{1F4CB} \u0424\u0430\u043A\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438:",{name:v[T],link:v[X],brand:v[I],qty:v[L],sum:v[W]}),{name:T,brand:I,link:X,qty:L,sum:W})},ee=async(t,y=te)=>{try{let v={competitorSelections:t.competitorSelections||{},uploadedFiles:t.uploadedFiles||{},parsedPrices:t.parsedPrices||{},lastUpdated:new Date().toISOString()};console.log("\u{1F4BE} \u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0445 \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:",{competitors:Object.keys(v.competitorSelections).length,files:Object.keys(v.uploadedFiles).length,size:JSON.stringify(v).length/1024+" KB"});let C=await fetch(`${oe}/data/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:y,data:v})});if(!C.ok){let z=await C.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${C.status} - ${z}`)}return await C.json()}catch(v){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:",v),v}},Ce=async(t=te)=>{try{let y=await fetch(`${oe}/data/load/${t}`);if(!y.ok){if(y.status===404)return{success:!1,data:null,message:"\u0424\u0430\u0439\u043B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D"};let v=await y.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${y.status} - ${v}`)}return await y.json()}catch(y){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",y),y}},ft=async()=>{try{let t=await fetch(`${oe}/data/files`);if(!t.ok){let y=await t.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${t.status} - ${y}`)}return await t.json()}catch(t){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u0444\u0430\u0439\u043B\u043E\u0432:",t),t}},wt=async t=>{try{let y=await fetch(`${oe}/data/delete/${t}`,{method:"DELETE"});if(!y.ok){let v=await y.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${y.status} - ${v}`)}return await y.json()}catch(y){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430:",y),y}},vt=async()=>{try{let t=await fetch(`${oe}/data/backup`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){let y=await t.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${t.status} - ${y}`)}return await t.json()}catch(t){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0431\u044D\u043A\u0430\u043F\u0430:",t),t}},ae=(t,y)=>{let v=Object.keys(t).sort().reverse();for(let C of v)if(t[C]?.[y])return{price:t[C][y],date:C};return null},_e=t=>Object.keys(t).some(y=>t[y]&&Object.keys(t[y]).length>0),Nt=({priceHistory:t})=>{let y=ce(null),v=ce(null),C=ce(null),z=ce(null),T=ce(null),X=ce(null);return ze(()=>{if(!y.current||!v.current||!C.current||t.length<2)return;let I=[...t].sort((F,q)=>new Date(F.date).getTime()-new Date(q.date).getTime()),L=I.map(F=>new Date(F.date).toLocaleDateString("ru-RU")),W=I.map(F=>F.priceNumber||0),P=I.map(F=>F.qtyNumber!==void 0&&F.qtyNumber!==null?F.qtyNumber:0),U=I.map(F=>F.sumNumber!==void 0&&F.sumNumber!==null?F.sumNumber:0);z.current&&z.current.destroy(),T.current&&T.current.destroy(),X.current&&X.current.destroy();let _=y.current.getContext("2d");_&&(z.current=new Pe(_,{type:"line",data:{labels:L,datasets:[{label:"\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card (\u20BD)",data:W,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.3,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,plugins:{title:{display:!0,text:"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0446\u0435\u043D",font:{size:16,weight:"bold"},color:"#333"},legend:{display:!0,position:"top",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(F){return`\u0426\u0435\u043D\u0430: ${I[F.dataIndex].price||"\u043D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"}`}}}},scales:{x:{display:!0,title:{display:!0,text:"\u0414\u0430\u0442\u0430",font:{weight:"bold"}},ticks:{maxRotation:45,minRotation:45}},y:{display:!0,title:{display:!0,text:"\u0426\u0435\u043D\u0430 (\u20BD)",font:{weight:"bold"}},beginAtZero:!1}},interaction:{intersect:!1,mode:"index"}}}));let B=v.current.getContext("2d");if(B){let F=P.some(q=>q>0);T.current=new Pe(B,{type:"bar",data:{labels:L,datasets:[{label:"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438",data:P,backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgb(255, 99, 132)",borderWidth:1}]},options:{responsive:!0,plugins:{title:{display:!0,text:"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0437\u0430\u043A\u0430\u0437\u043E\u0432",font:{size:16,weight:"bold"},color:"#333"},legend:{display:!0,position:"top",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(q){return`\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E: ${I[q.dataIndex].qty||"0"} \u0448\u0442`}}}},scales:{x:{display:!0,title:{display:!0,text:"\u0414\u0430\u0442\u0430",font:{weight:"bold"}},ticks:{maxRotation:45,minRotation:45}},y:{display:!0,title:{display:!0,text:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E (\u0448\u0442)",font:{weight:"bold"}},beginAtZero:!0}}}})}let M=C.current.getContext("2d");if(M){let F=U.some(q=>q>0);X.current=new Pe(M,{type:"bar",data:{labels:L,datasets:[{label:"\u0421\u0443\u043C\u043C\u0430 \u0437\u0430\u043A\u0430\u0437\u0430 (\u20BD)",data:U,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgb(54, 162, 235)",borderWidth:1}]},options:{responsive:!0,plugins:{title:{display:!0,text:"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0441\u0443\u043C\u043C\u044B \u0437\u0430\u043A\u0430\u0437\u043E\u0432",font:{size:16,weight:"bold"},color:"#333"},legend:{display:!0,position:"top",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(q){return`\u0421\u0443\u043C\u043C\u0430: ${I[q.dataIndex].sum||"0"} \u20BD`}}}},scales:{x:{display:!0,title:{display:!0,text:"\u0414\u0430\u0442\u0430",font:{weight:"bold"}},ticks:{maxRotation:45,minRotation:45}},y:{display:!0,title:{display:!0,text:"\u0421\u0443\u043C\u043C\u0430 (\u20BD)",font:{weight:"bold"}},beginAtZero:!0,ticks:{callback:function(q){return`${q} \u20BD`}}}}}})}return()=>{z.current&&z.current.destroy(),T.current&&T.current.destroy(),X.current&&X.current.destroy()}},[t]),t.length<2?React.createElement("div",{className:"text-center text-muted py-4"},React.createElement("i",{className:"bi bi-bar-chart fs-1 mb-3 d-block"}),React.createElement("p",null,"\u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u043F\u043E\u0441\u0442\u0440\u043E\u0435\u043D\u0438\u044F \u0433\u0440\u0430\u0444\u0438\u043A\u043E\u0432 (\u043D\u0443\u0436\u043D\u043E \u043C\u0438\u043D\u0438\u043C\u0443\u043C 2 \u0437\u0430\u043F\u0438\u0441\u0438)")):React.createElement("div",{className:"history-chart-container"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12 mb-4"},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-body"},React.createElement("div",{style:{position:"relative",height:"300px",width:"100%"}},React.createElement("canvas",{ref:y}))))),React.createElement("div",{className:"col-md-6 mb-4"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-body"},React.createElement("div",{style:{position:"relative",height:"250px",width:"100%"}},React.createElement("canvas",{ref:v}))))),React.createElement("div",{className:"col-md-6 mb-4"},React.createElement("div",{className:"card h-100"},React.createElement("div",{className:"card-body"},React.createElement("div",{style:{position:"relative",height:"250px",width:"100%"}},React.createElement("canvas",{ref:C})))))))},St=()=>{let[t,y]=H({vmpData:[],ozonData:{},ozonPrices:{},loading:!0,error:null,selectedType:null,uploadedFiles:{},usingFallback:!1,competitorSelections:{},activeModalSku:null,isParsingPrices:!1,parsedPrices:{},searchTerm:"",filteredRows:null,expandedProducts:{},salesData:{},salesLoading:!1,ozonCategories:{},collapsedCategories:{}}),[v,C]=H(null),[z,T]=H(new Set),[X,I]=H({current:0,total:0,status:""}),[L,W]=H(null),[P,U]=H(null),[_,B]=H(null),[M,F]=H({current:0,total:0,stage:""}),[q,le]=H([]),[E,R]=H(te),[Fe,Ke]=H(!1),[ve,Ie]=H(!1),[Z,Ne]=H({competitor:null,productName:""});ze(()=>{He(),de();let e=setInterval(()=>{Oe()},5*60*1e3);return()=>{clearInterval(e)}},[]),ze(()=>{if((Object.keys(t.competitorSelections).length>0||Object.keys(t.uploadedFiles).length>0)&&!ve){let s=setTimeout(()=>{Oe()},2e3);return()=>clearTimeout(s)}},[t.competitorSelections,t.uploadedFiles,E]);let He=async()=>{try{console.log("\u{1F504} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445...");let e=[],s=!1;try{console.log("\u{1F310} \u0417\u0430\u043F\u0440\u043E\u0441 \u043A:",Ve);let r=await fetch(Ve,{method:"GET",headers:{Accept:"application/json"}});if(console.log("\u{1F4CA} \u0421\u0442\u0430\u0442\u0443\u0441:",r.status,"OK:",r.ok),!r.ok){let b=await r.text();throw console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 API:",b),new Error(`VMP API Error: ${r.status}`)}let u=await r.text();console.log("\u{1F4E6} \u0421\u044B\u0440\u043E\u0439 \u043E\u0442\u0432\u0435\u0442 (\u043F\u0435\u0440\u0432\u044B\u0435 500 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432):",u.substring(0,500));let p;try{p=JSON.parse(u),console.log("\u2705 JSON \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0440\u0430\u0441\u043F\u0430\u0440\u0441\u0435\u043D:",typeof p)}catch(b){throw console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 JSON:",b.message),new Error("Invalid JSON response")}Array.isArray(p)?(e=p,console.log(`\u2705 \u041F\u043E\u043B\u0443\u0447\u0435\u043D \u043C\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 ${e.length} \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432`)):(console.warn("\u26A0\uFE0F \u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u0441\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u043E\u0442\u0432\u0435\u0442\u0430:",p),e=[])}catch(r){console.warn("\u274C API Fetch failed:",r.message);try{console.log("\u{1F504} \u041F\u0440\u043E\u0431\u0443\u0435\u043C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C fallback \u0434\u0430\u043D\u043D\u044B\u0435...");let u=await fetch("./data_cache.json");if(!u.ok)throw new Error("Could not load local cache file");e=(await u.json()).data||[],s=!0,console.log(`\u2705 \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C fallback: ${e.length} \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432`)}catch(u){throw console.error("\u{1F4A5} Fallback \u0442\u043E\u0436\u0435 \u043D\u0435 \u0441\u0440\u0430\u0431\u043E\u0442\u0430\u043B:",u),new Error("Failed to load data from any source.")}}e.length===0?console.warn("\u26A0\uFE0F \u041F\u043E\u043B\u0443\u0447\u0435\u043D \u043F\u0443\u0441\u0442\u043E\u0439 \u043C\u0430\u0441\u0441\u0438\u0432 \u0442\u043E\u0432\u0430\u0440\u043E\u0432"):console.log(`\u{1F389} \u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E: ${e.length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`);let a={};e.forEach(r=>{r.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430&&(a[r.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430]=(a[r.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430]||0)+1)});let n=Object.entries(a).sort((r,u)=>u[1]-r[1]),i=n.length>0?n[0][0]:null;console.log("\u{1F3F7}\uFE0F \u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438:",n);let o=Array.from(new Set(e.map(r=>r.\u0410\u0440\u0442\u0438\u043A\u0443\u043B).filter(Boolean))),l={},d={};try{console.log("\u{1F6D2} \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C Ozon \u0434\u0430\u043D\u043D\u044B\u0435..."),l=await Xe(o),console.log(`\u2705 Ozon \u0434\u0430\u043D\u043D\u044B\u0445: ${Object.keys(l).length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`)}catch(r){console.warn("Ozon API fetch failed",r)}try{console.log("\u{1F4B0} \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0435...");let r=Array.from(new Set(e.map(u=>u.\u0410\u0440\u0442\u0438\u043A\u0443\u043B).filter(Boolean)));d=await Qe(r,l),console.log(`\u2705 \u0414\u0430\u043D\u043D\u044B\u0445 \u043E \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0435: ${Object.keys(d).length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`)}catch(r){console.warn("Ozon prices API fetch failed",r)}let m={};try{console.log("\u{1F4CA} \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E..."),m=await Je(),console.log(`\u2705 \u0414\u0430\u043D\u043D\u044B\u0445 \u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u0445: ${Object.keys(m).length} SKU`)}catch(r){console.warn("Ozon sales API fetch failed",r)}let c={};try{let r=Array.from(new Set(Object.values(l).map(u=>u.type_id).filter(u=>u!==void 0&&u>0)));r.length>0&&(console.log("\u{1F4C1} \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F \u0442\u0438\u043F\u043E\u0432 \u0442\u043E\u0432\u0430\u0440\u043E\u0432..."),c=await We(r))}catch(r){console.warn("Ozon categories fetch failed",r)}y(r=>({...r,vmpData:e,ozonData:l,ozonPrices:d,salesData:m,ozonCategories:c,loading:!1,usingFallback:s,selectedType:i})),console.log("\u{1F680} \u041F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u0433\u043E\u0442\u043E\u0432\u043E!")}catch(e){console.error("\u{1F4A5} \u041A\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430:",e),y(s=>({...s,loading:!1,error:`\u041E\u0448\u0438\u0431\u043A\u0430: ${e.message}`}))}},We=async e=>{let s={};if(e.length===0)return s;console.log("\u{1F4C1} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0439 \u0442\u0438\u043F\u043E\u0432 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 Ozon \u0434\u043B\u044F",e.length,"ID:",e);let a=pe[0];try{let n=await fetch("https://api-seller.ozon.ru/v1/description-category/tree",{method:"POST",headers:{"Content-Type":"application/json","Client-Id":a.client_id,"Api-Key":a.api_key},body:JSON.stringify({language:"RU"})});if(n.ok){let i=await n.json();console.log("\u{1F4C1} \u041E\u0442\u0432\u0435\u0442 \u043E\u0442 description-category/tree \u043F\u043E\u043B\u0443\u0447\u0435\u043D");let o=d=>{d.children&&Array.isArray(d.children)&&d.children.forEach(m=>{if(m.type_id&&e.includes(m.type_id)){let c=m.type_name||m.category_name||m.title;c&&(s[m.type_id]=c,console.log(`\u{1F4C1} \u041D\u0430\u0439\u0434\u0435\u043D \u0442\u0438\u043F \u0442\u043E\u0432\u0430\u0440\u0430: ${m.type_id} = "${c}"`))}m.description_category_id&&o(m)})},l=i.result||[];Array.isArray(l)&&l.forEach(d=>o(d)),console.log(`\u2705 \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0439 \u0442\u0438\u043F\u043E\u0432: ${Object.keys(s).length} \u0438\u0437 ${e.length}`)}else{let i=await n.text();console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439: ${n.status}`,i.substring(0,200))}}catch(n){console.warn("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u043F\u0440\u043E\u0441\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439:",n.message)}return s},Xe=async e=>{let a={};if(console.log("\u{1F6D2} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 Ozon \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0430\u0440\u0442\u0438\u043A\u0443\u043B\u043E\u0432:",e.length),e.length===0)return console.log("\u26A0\uFE0F \u041D\u0435\u0442 \u0430\u0440\u0442\u0438\u043A\u0443\u043B\u043E\u0432 \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 Ozon \u0434\u0430\u043D\u043D\u044B\u0445"),a;let n=[];for(let o=0;o<e.length;o+=50)n.push(e.slice(o,o+50));console.log(`\u{1F4E6} \u0420\u0430\u0437\u0434\u0435\u043B\u0438\u043B\u0438 \u043D\u0430 ${n.length} \u0447\u0430\u043D\u043A\u043E\u0432 \u043F\u043E 50 \u0430\u0440\u0442\u0438\u043A\u0443\u043B\u043E\u0432`);let i=[];for(let o=0;o<n.length;o++){let l=n[o];F({current:o+1,total:n.length,stage:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u0442\u043E\u0432\u0430\u0440\u0430\u0445"}),console.log(`
\u{1F4CA} \u0427\u0430\u043D\u043A ${o+1}/${n.length}: \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u0442\u043E\u0432\u0430\u0440\u0430\u0445`);let d=[...l];for(let m of pe){if(d.length===0)break;console.log(`\u{1F510} \u0410\u043A\u043A\u0430\u0443\u043D\u0442: ${m.name}, \u043E\u0441\u0442\u0430\u043B\u043E\u0441\u044C: ${d.length}`);try{let c=await fetch("https://api-seller.ozon.ru/v3/product/info/list",{method:"POST",headers:{"Content-Type":"application/json","Client-Id":m.client_id,"Api-Key":m.api_key},body:JSON.stringify({offer_id:d})});if(console.log(`\u{1F4E1} \u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0442\u0432\u0435\u0442\u0430 v3/product/info/list: ${c.status}`),c.ok){let r=await c.json();console.log(`\u{1F4E6} \u041E\u0442\u0432\u0435\u0442 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442: ${r.items?.length||0} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`),r.items&&Array.isArray(r.items)&&r.items.forEach(u=>{u.is_archived||(i.push({offer_id:u.offer_id,sku:u.sku,price:u.price,primary_image:Array.isArray(u.primary_image)?u.primary_image[0]:u.primary_image,images:u.images,is_archived:u.is_archived,description_category_id:u.description_category_id,type_id:u.type_id}),d=d.filter(p=>p!==u.offer_id),console.log(`\u2705 \u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0442\u043E\u0432\u0430\u0440: ${u.offer_id}, SKU: ${u.sku}, \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F: ${u.description_category_id}, \u0442\u0438\u043F: ${u.type_id}`))})}else{let r=await c.text();console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 API v3/product/info/list: ${c.status}`,r.substring(0,200))}}catch(c){console.warn(`\u274C \u0421\u0435\u0442\u0435\u0432\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u0434\u043B\u044F \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430 ${m.name}:`,c.message)}await new Promise(c=>setTimeout(c,500))}console.log(`\u2705 \u0427\u0430\u043D\u043A ${o+1} \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D, \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0442\u043E\u0432\u0430\u0440\u043E\u0432: ${i.length}`)}if(i.length>0){console.log(`
\u{1F4B0} \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0446\u0435\u043D \u043F\u043E Ozon Card \u0434\u043B\u044F ${i.length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`);let o=i.filter(c=>c.sku&&c.sku>0).map(c=>c.sku.toString());console.log(`\u{1F522} \u041D\u0430\u0439\u0434\u0435\u043D\u043E SKU: ${o.length}`);let l=100,d=[];for(let c=0;c<o.length;c+=l)d.push(o.slice(c,c+l));console.log(`\u{1F4CA} \u0420\u0430\u0437\u0434\u0435\u043B\u0438\u043B\u0438 SKU \u043D\u0430 ${d.length} \u0447\u0430\u043D\u043A\u043E\u0432 \u0434\u043B\u044F \u0437\u0430\u043F\u0440\u043E\u0441\u0430 \u0446\u0435\u043D`);let m={};for(let c=0;c<d.length;c++){let r=d[c];F({current:c+1,total:d.length,stage:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0446\u0435\u043D \u043F\u043E Ozon Card"}),console.log(`
\u{1F4B3} \u0427\u0430\u043D\u043A ${c+1}/${d.length}: \u0417\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C \u0446\u0435\u043D\u044B \u0434\u043B\u044F ${r.length} SKU`);let u=[...r];for(let p of pe){if(u.length===0)break;console.log(`\u{1F510} \u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0434\u043B\u044F \u0446\u0435\u043D: ${p.name}, \u043E\u0441\u0442\u0430\u043B\u043E\u0441\u044C SKU: ${u.length}`);try{let b=await fetch("https://api-seller.ozon.ru/v1/product/prices/details",{method:"POST",headers:{"Content-Type":"application/json","Client-Id":p.client_id,"Api-Key":p.api_key},body:JSON.stringify({skus:u})});if(console.log(`\u{1F4E1} \u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0442\u0432\u0435\u0442\u0430 v1/product/prices/details: ${b.status}`),b.ok){let f=await b.json();console.log(`\u{1F4B0} \u0410\u043A\u043A\u0430\u0443\u043D\u0442 ${p.name}: \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${f.prices?.length||0} \u0446\u0435\u043D`),f.prices&&Array.isArray(f.prices)&&f.prices.forEach(w=>{m[w.sku.toString()]||(m[w.sku.toString()]=w,u=u.filter(S=>S!==w.sku.toString()),console.log(`\u2705 \u0426\u0435\u043D\u0430 \u043E\u0442 ${p.name} \u0434\u043B\u044F SKU ${w.sku}: ${w.customer_price.amount} ${w.customer_price.currency}`))})}else{let f=await b.text();console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 API v1/product/prices/details \u0443 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430 ${p.name}: ${b.status}`,f.substring(0,200))}}catch(b){console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0446\u0435\u043D \u043E\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430 ${p.name}:`,b.message)}await new Promise(b=>setTimeout(b,1e3))}console.log(`\u2705 \u0427\u0430\u043D\u043A ${c+1} \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D, \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0446\u0435\u043D: ${Object.keys(m).length}`)}console.log(`
\u{1F517} \u041E\u0431\u044A\u0435\u0434\u0438\u043D\u044F\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u0442\u043E\u0432\u0430\u0440\u0430\u0445 \u0438 \u0446\u0435\u043D\u0430\u0445...`),i.forEach(c=>{if(c.sku&&m[c.sku.toString()]){let r=m[c.sku.toString()];a[c.offer_id]={offer_id:c.offer_id,sku:c.sku,price:c.price||"0",customer_price:`${r.customer_price.amount} ${r.customer_price.currency}`,primary_image:c.primary_image,images:c.images,is_archived:c.is_archived,description_category_id:c.description_category_id,type_id:c.type_id},console.log(`\u{1F3AF} ${c.offer_id}: \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F: ${c.description_category_id}, \u0442\u0438\u043F: ${c.type_id}`)}else c.price&&(a[c.offer_id]={offer_id:c.offer_id,sku:c.sku,price:c.price,customer_price:void 0,primary_image:c.primary_image,images:c.images,is_archived:c.is_archived,description_category_id:c.description_category_id,type_id:c.type_id},console.log(`\u26A0\uFE0F ${c.offer_id}: \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F: ${c.description_category_id}, \u0442\u0438\u043F: ${c.type_id}`))})}else console.log("\u26A0\uFE0F \u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0446\u0435\u043D");return console.log(`
\u{1F389} \u0418\u0442\u043E\u0433: \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E ${Object.keys(a).length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0441 \u0446\u0435\u043D\u0430\u043C\u0438`),F({current:0,total:0,stage:""}),a},Qe=async(e,s)=>{let a={};if(console.log("\u{1F4B0} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0446\u0435\u043D \u0438 \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0430 \u0434\u043B\u044F \u0442\u043E\u0432\u0430\u0440\u043E\u0432:",e.length),e.length===0)return console.log("\u26A0\uFE0F \u041D\u0435\u0442 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0446\u0435\u043D"),a;let n=[],i={};if(e.forEach(m=>{let c=s[m];if(c&&c.sku){let r=c.sku.toString();n.push(r),i[r]=m,console.log(`\u{1F517} \u041C\u0430\u043F\u043F\u0438\u043D\u0433: SKU ${r} -> offer_id ${m}`)}else console.log(`\u26A0\uFE0F \u0423 \u0442\u043E\u0432\u0430\u0440\u0430 ${m} \u043D\u0435\u0442 SKU \u0438\u043B\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0432 ozonData`)}),n.length===0)return console.log("\u26A0\uFE0F \u041D\u0435\u0442 SKU \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0430"),a;console.log(`\u{1F522} \u041D\u0430\u0439\u0434\u0435\u043D\u043E SKU: ${n.length} \u0438\u0437 ${e.length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`),console.log("\u{1F4CB} \u041C\u0430\u043F\u043F\u0438\u043D\u0433 SKU->offer_id:",i);let o=100,l=[];for(let m=0;m<n.length;m+=o)l.push(n.slice(m,m+o));console.log(`\u{1F4E6} \u0420\u0430\u0437\u0434\u0435\u043B\u0438\u043B\u0438 \u043D\u0430 ${l.length} \u0447\u0430\u043D\u043A\u043E\u0432 \u043F\u043E ${o} SKU`);for(let m=0;m<l.length;m++){let c=l[m];console.log(`
\u{1F4B3} \u0427\u0430\u043D\u043A ${m+1}/${l.length}: \u0417\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442 \u0434\u043B\u044F ${c.length} SKU`);let r=[...c];for(let u of pe){if(r.length===0)break;console.log(`\u{1F510} \u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0434\u043B\u044F \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0430: ${u.name}, \u043E\u0441\u0442\u0430\u043B\u043E\u0441\u044C SKU: ${r.length}`);try{let p=await fetch("https://api-seller.ozon.ru/v1/product/prices/details",{method:"POST",headers:{"Content-Type":"application/json","Client-Id":u.client_id,"Api-Key":u.api_key},body:JSON.stringify({skus:r})});if(console.log(`\u{1F4E1} \u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0442\u0432\u0435\u0442\u0430 v1/product/prices/details: ${p.status}`),p.ok){let b=await p.json();console.log(`\u{1F4B0} \u0410\u043A\u043A\u0430\u0443\u043D\u0442 ${u.name}: \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${b.prices?.length||0} \u0446\u0435\u043D \u0441 \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u043E\u043C`),b.prices&&Array.isArray(b.prices)&&b.prices.forEach(f=>{let w=f.sku.toString();a[w]||(a[w]=f,r=r.filter(S=>S!==w),console.log(`\u2705 \u0421\u043E\u0438\u043D\u0432\u0435\u0441\u0442 \u043E\u0442 ${u.name} \u0434\u043B\u044F SKU ${w}: ${f.discount_percent}`))})}else{let b=await p.text();console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 API v1/product/prices/details \u0443 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430 ${u.name}: ${p.status}`,b.substring(0,200))}}catch(p){console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0430 \u043E\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430 ${u.name}:`,p.message)}await new Promise(p=>setTimeout(p,1e3))}console.log(`\u2705 \u0427\u0430\u043D\u043A ${m+1} \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D, \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0437\u0430\u043F\u0438\u0441\u0435\u0439: ${Object.keys(a).length}`)}let d={};return Object.entries(a).forEach(([m,c])=>{let r=i[m];r?(d[r]=c,console.log(`\u{1F517} \u0421\u0432\u044F\u0437\u0430\u043B\u0438: SKU ${m} -> offer_id ${r}`)):console.warn(`\u26A0\uFE0F \u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D offer_id \u0434\u043B\u044F SKU ${m}`)}),console.log(`
\u{1F389} \u0418\u0442\u043E\u0433: \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0441\u043E\u0438\u043D\u0432\u0435\u0441\u0442\u0430 \u0434\u043B\u044F ${Object.keys(d).length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`),console.log("\u{1F4CA} \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430:",{totalOfferIds:e.length,foundSkus:n.length,loadedPrices:Object.keys(a).length,mappedToOffers:Object.keys(d).length}),d},Je=async()=>{let e={},s=new Date,a=[];for(let n=0;n<7;n++){let i=new Date(s);i.setDate(i.getDate()-n),a.push({day:i.getDate(),month:i.getMonth()+1,year:i.getFullYear()})}console.log("\u{1F4CA} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E:",a);for(let n of a)for(let i of pe){try{console.log(`\u{1F4C5} \u0417\u0430\u043F\u0440\u043E\u0441 \u043F\u0440\u043E\u0434\u0430\u0436 \u0437\u0430 ${n.day}.${n.month}.${n.year} \u043E\u0442 ${i.name}`);let o=await fetch("https://api-seller.ozon.ru/v1/finance/realization/by-day",{method:"POST",headers:{"Content-Type":"application/json","Client-Id":i.client_id,"Api-Key":i.api_key},body:JSON.stringify(n)});if(o.ok){let l=await o.json();l.rows&&Array.isArray(l.rows)&&(l.rows.forEach(d=>{let m=d.item?.sku?String(d.item.sku):null;if(m){let c=d.delivery_commission?.quantity||0,r=(d.seller_price_per_instance||0)*c;e[m]||(e[m]={qty:0,sum:0}),e[m].qty+=c,e[m].sum+=r}}),console.log(`\u2705 ${i.name}: \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${l.rows.length} \u0437\u0430\u043F\u0438\u0441\u0435\u0439 \u0437\u0430 ${n.day}.${n.month}`))}else console.warn(`\u26A0\uFE0F \u041E\u0448\u0438\u0431\u043A\u0430 API \u0434\u043B\u044F ${i.name}: ${o.status}`)}catch(o){console.warn(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043F\u0440\u043E\u0434\u0430\u0436 \u043E\u0442 ${i.name}:`,o.message)}await new Promise(o=>setTimeout(o,300))}return console.log(`\u{1F389} \u0418\u0442\u043E\u0433: \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u0445 \u0434\u043B\u044F ${Object.keys(e).length} SKU`),e},de=async()=>{try{let e=await ft();if(e.success)if(le(e.files),e.files.length>0){let s=e.files.find(n=>n.name===`${te}.json`),a=s?s.name:e.files[0].name;await Se(a.replace(".json",""))}else try{let s=await Ce(te);s.success&&s.data&&(R(te),y(a=>({...a,competitorSelections:s.data.competitorSelections||{},parsedPrices:s.data.parsedPrices||{},uploadedFiles:s.data.uploadedFiles||{}})))}catch{console.log("\u041E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u0444\u0430\u0439\u043B \u0434\u0430\u043D\u043D\u044B\u0445 \u0435\u0449\u0451 \u043D\u0435 \u0441\u043E\u0437\u0434\u0430\u043D")}}catch(e){console.warn("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0444\u0430\u0439\u043B\u043E\u0432:",e)}},Oe=async()=>{if((Object.keys(t.competitorSelections).length>0||Object.keys(t.uploadedFiles).length>0)&&!ve){let s=Date.now(),a=localStorage.getItem("lastSaveTime");if(a&&s-parseInt(a)<3e4){console.log("\u23F3 \u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0440\u0430\u043D\u043E \u0434\u043B\u044F \u0430\u0432\u0442\u043E\u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F");return}try{Ie(!0);let i={competitorSelections:t.competitorSelections,parsedPrices:t.parsedPrices,uploadedFiles:t.uploadedFiles,lastUpdated:new Date().toISOString()};await ee(i,E),localStorage.setItem("lastSaveTime",s.toString()),console.log("\u{1F4BE} \u0414\u0430\u043D\u043D\u044B\u0435 \u0430\u0432\u0442\u043E\u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B")}catch(i){console.warn("\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F:",i)}finally{Ie(!1)}}},Ze=async()=>{y(e=>({...e,isParsingPrices:!0})),I({current:0,total:0,status:"\u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F..."});try{let e=t.selectedType?t.vmpData.filter(h=>h.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430===t.selectedType):t.vmpData,s=new Set(e.map(h=>h.\u0410\u0440\u0442\u0438\u043A\u0443\u043B)),a=[];Object.entries(t.competitorSelections).forEach(([h,g])=>{if(!s.has(h))return;g.forEach($=>{if($.link&&$.link.includes("ozon.ru")){let O=ge($.link);O&&/^\d+$/.test(O)&&a.push({vmpSku:h,competitor:$,sku:O})}})});let n=[];if(e.forEach(h=>{let g=t.ozonData[h.\u0410\u0440\u0442\u0438\u043A\u0443\u043B];g&&g.sku&&n.push({sku:String(g.sku),article:h.\u0410\u0440\u0442\u0438\u043A\u0443\u043B})}),a.length===0&&n.length===0){alert(t.selectedType?`\u041D\u0435\u0442 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 "${t.selectedType}"`:"\u041D\u0435\u0442 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430"),y(h=>({...h,isParsingPrices:!1}));return}let i=a.map(h=>h.sku),o=n.map(h=>h.sku),l=[...i,...o],d=[...new Set(l)];console.log(`\u{1F50D} \u041D\u0430\u0447\u0438\u043D\u0430\u0435\u043C \u043F\u0430\u0440\u0441\u0438\u043D\u0433 SKU \u0434\u043B\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 "${t.selectedType||"\u0412\u0441\u0435"}":`,d),I({current:0,total:d.length,status:t.selectedType?`\u041F\u0430\u0440\u0441\u0438\u043D\u0433 ${d.length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432 (${t.selectedType})...`:`\u041F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u043A\u0430 \u043A \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0443 ${d.length} \u0442\u043E\u0432\u0430\u0440\u043E\u0432...`});try{if(!(await fetch(`${oe}/health`)).ok)throw new Error("\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D")}catch{alert(`\u26A0\uFE0F \u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u043D\u0435 \u0437\u0430\u043F\u0443\u0449\u0435\u043D.

\u0417\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u0435 \u0432 \u043E\u0442\u0434\u0435\u043B\u044C\u043D\u043E\u043C \u0442\u0435\u0440\u043C\u0438\u043D\u0430\u043B\u0435:
node server.js

\u0418\u043B\u0438 \u0435\u0441\u043B\u0438 \u0435\u0441\u0442\u044C \u043E\u0448\u0438\u0431\u043A\u0438:
npm install chromedriver
node server.js`),y(g=>({...g,isParsingPrices:!1}));return}I({current:0,total:d.length,status:"\u041E\u0436\u0438\u0434\u0430\u043D\u0438\u0435 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E\u0433\u043E \u043F\u0430\u0440\u0441\u0435\u0440\u0430..."});let m=await fetch(`${oe}/parse-local`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({skus:d})});if(!m.ok){let h=await m.text();throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${m.status} - ${h}`)}let c=await m.json();console.log("\u{1F4CA} \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u044B \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430:",c);let r={};c.results&&Array.isArray(c.results)&&c.results.forEach(h=>{h.success&&h.price&&h.price!=="\u0426\u0435\u043D\u0430 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430"&&h.price!=="\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438"&&h.price!=="\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E"&&h.price.includes("\u20BD")?(r[h.sku]=h.price,console.log(`\u2705 \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u0446\u0435\u043D\u0443 \u0434\u043B\u044F ${h.sku}: ${h.price}`)):h.price&&console.log(`\u274C \u041F\u0440\u043E\u043F\u0443\u0441\u043A\u0430\u0435\u043C ${h.sku}: ${h.price} (success: ${h.success})`)});let u={...t.competitorSelections},p={},b=new Date,f=b.toISOString().split("T")[0],w=b.toLocaleDateString("ru-RU");n.forEach(({sku:h,article:g})=>{r[h]&&(p[g]=r[h],console.log(`\u2705 \u0421\u043F\u0430\u0440\u0441\u0435\u043D\u0430 \u0446\u0435\u043D\u0430 \u0434\u043B\u044F \u043D\u0430\u0448\u0435\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430 ${g} (SKU: ${h}): ${r[h]}`))});let S=0;a.forEach(({vmpSku:h,competitor:g,sku:k})=>{if(r[k]){u[h]||(u[h]=[]);let $=u[h].findIndex(O=>O.link===g.link);if($!==-1){let O=u[h][$],Q=g.qty&&g.qty!==""&&g.qty!==0?g.qty:O.qty,K=g.sum&&g.sum!==""&&g.sum!==0?g.sum:O.sum,re=we(r[k]),ne=Q?parseFloat(String(Q)):void 0,fe=K?parseFloat(String(K)):void 0,J=O.priceHistory||[],ke=J.findIndex(G=>G.date.startsWith(f));if(ke!==-1)J[ke]={price:r[k],priceNumber:re,date:b.toISOString(),source:"ozon_card_parser",qty:Q,sum:K,qtyNumber:ne,sumNumber:fe};else{let G=J.length>0?J[J.length-1]:null;!G||G&&Math.abs(new Date(b).getTime()-new Date(G.date).getTime())>6*24*60*60*1e3?J.push({price:r[k],priceNumber:re,date:b.toISOString(),source:"ozon_card_parser",qty:Q,sum:K,qtyNumber:ne,sumNumber:fe}):J.push({price:r[k],priceNumber:re,date:b.toISOString(),source:"ozon_card_parser",qty:void 0,sum:void 0,qtyNumber:void 0,sumNumber:void 0})}u[h][$]={...O,ozonCardPrice:r[k],qty:Q,sum:K,lastUpdated:b.toISOString(),priceHistory:J}}else{let O=we(r[k]),Q=g.qty?parseFloat(String(g.qty)):void 0,K=g.sum?parseFloat(String(g.sum)):void 0;u[h].push({...g,ozonCardPrice:r[k],lastUpdated:b.toISOString(),priceHistory:[{price:r[k],priceNumber:O,date:b.toISOString(),source:"ozon_card_parser",qty:g.qty,sum:g.sum,qtyNumber:Q,sumNumber:K}]})}S++,console.log(`\u2705 \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0446\u0435\u043D\u0430 \u0434\u043B\u044F ${h} -> ${k}: ${r[k]}, qty: ${g.qty}, sum: ${g.sum}`)}});try{let h={date:f,timestamp:b.toISOString(),prices:r,competitorSelections:u,summary:{totalParsed:d.length,successful:S,failed:d.length-S}};await ee(h,`daily_data_${f}`);let g={...t.parsedPrices,[f]:{...t.parsedPrices[f]||{},...p}};await ee({competitorSelections:u,parsedPrices:g,uploadedFiles:t.uploadedFiles,lastUpdated:b.toISOString()},E),console.log("\u2705 \u0426\u0435\u043D\u044B \u0438 \u0438\u0441\u0442\u043E\u0440\u0438\u044F \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B")}catch(h){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445:",h)}y(h=>({...h,competitorSelections:u,parsedPrices:{...h.parsedPrices,[f]:{...h.parsedPrices[f]||{},...p}},isParsingPrices:!1}));let A=Object.keys(p).length,D=S,j=A+D,N=d.length-j,x="";j>0?(x=`\u2705 \u041F\u0430\u0440\u0441\u0438\u043D\u0433 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D!

`,x+=`\u{1F4E6} \u041D\u0430\u0448\u0438\u0445 \u0442\u043E\u0432\u0430\u0440\u043E\u0432: ${A}
`,x+=`\u{1F3E2} \u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432: ${D}
`,x+=`\u{1F4CA} \u0412\u0441\u0435\u0433\u043E \u0441\u043F\u0430\u0440\u0441\u0435\u043D\u043E: ${j}`,N>0&&(x+=`
\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C: ${N}`),x+=`

\u{1F4C5} \u0414\u0430\u0442\u0430: ${w}
\u{1F4BE} \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B:
\u2022 \u041E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u0444\u0430\u0439\u043B: ${E}
\u2022 \u0415\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u044B\u0439 \u0444\u0430\u0439\u043B: daily_data_${f}.json`):x="\u274C \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0446\u0435\u043D\u044B \u043D\u0438 \u0434\u043B\u044F \u043E\u0434\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430",alert(x),I({current:d.length,total:d.length,status:x}),setTimeout(()=>{I({current:0,total:0,status:""})},5e3)}catch(e){console.error("\u{1F4A5} \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430:",e),y(a=>({...a,isParsingPrices:!1}));let s=e.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430";(s.includes("Failed to fetch")||s.includes("NetworkError"))&&(s="\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438"),I({current:0,total:0,status:`\u274C \u041E\u0448\u0438\u0431\u043A\u0430: ${s}`}),alert(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435:
${s}`),setTimeout(()=>{I({current:0,total:0,status:""})},5e3)}},Ge=(e,s)=>{let a=e.priceHistory.map(i=>({...i,priceNumber:i.priceNumber||we(i.price),qtyNumber:i.qtyNumber||i.qty&&parseFloat(String(i.qty))||0,sumNumber:i.sumNumber||i.sum&&parseFloat(String(i.sum))||0})),n={...e,priceHistory:a};Ne({competitor:n,productName:s})},Ye=async(e,s)=>{if(confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0433\u043E \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430?")){let a={...t.competitorSelections};if(a[e]){a[e].splice(s,1);try{await ee({competitorSelections:a,parsedPrices:t.parsedPrices,uploadedFiles:t.uploadedFiles,lastUpdated:new Date().toISOString()},E),y(n=>({...n,competitorSelections:a}))}catch(n){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F:",n)}}}},Re=e=>{y(s=>({...s,selectedType:e}))},kt=e=>{let s=e.target.files?.[0];if(!s||!t.selectedType)return;if(s.size>10*1024*1024){alert("\u0424\u0430\u0439\u043B \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0439. \u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440: 10MB");return}let a=new FileReader;a.onload=n=>{let i=n.target?.result,o=window.XLSX.read(i,{type:"array"}),l=o.SheetNames[0],d=o.Sheets[l],m=window.XLSX.utils.sheet_to_json(d,{header:1,defval:"",raw:!1,blankrows:!1});console.log("\u{1F4CA} \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435:",{sheetName:l,totalRows:m.length,headers:m[0],firstRow:m[1]});let r=m.slice(0,1e3+1);if(r.length<2){alert("\u0424\u0430\u0439\u043B \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u0430\u043B \u0438\u043B\u0438 \u043D\u0435 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u0434\u0430\u043D\u043D\u044B\u0445");return}let u=r[0],p=Y(r);if(p.name===-1||p.link===-1||p.brand===-1||p.qty===-1||p.sum===-1){alert(`\u274C \u0412 \u0444\u0430\u0439\u043B\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u0432\u0441\u0435 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u044B\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438!

\u041E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438:
1. \u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430
2. \u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u043E\u0432\u0430\u0440
3. \u0411\u0440\u0435\u043D\u0434 (\u0438\u043B\u0438 \u041F\u0440\u043E\u0434\u0430\u0432\u0435\u0446)
4. \u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438
5. \u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0430 \u0441\u0443\u043C\u043C\u0443, \u20BD

\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438 \u0432 Excel \u0444\u0430\u0439\u043B\u0435.`);return}console.log("\u2705 \u0412\u0441\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E"),console.log("\u{1F4CB} \u041F\u0440\u0438\u043C\u0435\u0440 \u0434\u0430\u043D\u043D\u044B\u0445 (\u043F\u0435\u0440\u0432\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430):",{name:r[1][p.name],link:r[1][p.link],brand:r[1][p.brand],qty:r[1][p.qty],sum:r[1][p.sum]});let b=r;console.log("\u{1F504} \u0410\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u043F\u043E\u0434\u0431\u043E\u0440 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 \u043F\u043E \u043E\u0431\u044A\u0451\u043C\u0443...");let f=je(b,p,t.vmpData),w={...t.competitorSelections};Object.entries(f).forEach(([j,N])=>{w[j]=N});let S=Object.keys(f).length,A=Object.values(f).reduce((j,N)=>j+N.length,0),D={...t.uploadedFiles,[t.selectedType]:b};ee({competitorSelections:w,parsedPrices:t.parsedPrices,uploadedFiles:D,lastUpdated:new Date().toISOString()},E).then(()=>{y(j=>({...j,uploadedFiles:D,competitorSelections:w})),alert(`\u2705 \u0424\u0430\u0439\u043B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D
\u0421\u0442\u0440\u043E\u043A: ${b.length-1}

\u{1F3AF} \u0410\u0432\u0442\u043E\u043F\u043E\u0434\u0431\u043E\u0440 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432:
\u2022 \u0422\u043E\u0432\u0430\u0440\u043E\u0432 \u0441 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430\u043C\u0438: ${S}
\u2022 \u0412\u0441\u0435\u0433\u043E \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432: ${A}

\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B \u043F\u043E\u0434\u043E\u0431\u0440\u0430\u043D\u044B \u043F\u043E \u0441\u0445\u043E\u0436\u0435\u043C\u0443 \u043E\u0431\u044A\u0451\u043C\u0443.`)}).catch(j=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430:",j),alert("\u26A0\uFE0F \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0444\u0430\u0439\u043B\u0430")})},a.readAsArrayBuffer(s)},et=(e,s)=>{let a=new Set(s.map(n=>n.originalIndex));T(a),y(n=>({...n,activeModalSku:e}))},De=()=>{y(e=>({...e,activeModalSku:null})),T(new Set),W(null),U(null)},tt=async()=>{if(!t.activeModalSku||!t.selectedType)return;let e=t.uploadedFiles[t.selectedType];if(!e||e.length<2)return;let s=e[0],a=Y(e);console.log("\u{1F4CB} \u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438 Excel:",s),console.log("\u{1F5FA}\uFE0F \u0421\u043E\u043F\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043A\u043E\u043B\u043E\u043D\u043E\u043A:",a);let n=[];if(z.forEach(o=>{let l=e[o];if(l&&l.length>0){let d=a.link!==-1&&l[a.link]?String(l[a.link]).trim():"#",m=a.name!==-1&&l[a.name]?String(l[a.name]).trim():"\u041D\u0435\u0442 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F",c=a.brand!==-1&&l[a.brand]?String(l[a.brand]).trim():"-",r="";if(a.qty!==-1&&l[a.qty]!==void 0&&l[a.qty]!==null){let w=l[a.qty];r=typeof w=="number"?new Intl.NumberFormat("ru-RU").format(w):String(w).trim()}let u="";if(a.sum!==-1&&l[a.sum]!==void 0&&l[a.sum]!==null){let w=l[a.sum];if(typeof w=="number")u=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)+" \u20BD";else{let S=String(w).trim();u=S?S.includes("\u20BD")?S:S+" \u20BD":""}}let p=ge(d),b=r?parseFloat(r.replace(/\s+/g,"").replace(",",".")):void 0,f=u?parseFloat(u.replace(/[^\d.,]/g,"").replace(",",".")):void 0;console.log("\u{1F4DD} \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430:",{name:m,brand:c,link:d,qty:r,sum:u,sku:p}),n.push({name:m,brand:c,link:d,qty:r,sum:u,originalIndex:o,sku:p||void 0,lastUpdated:new Date().toISOString(),priceHistory:[{date:new Date().toISOString(),price:"",priceNumber:0,source:"initial_selection",qty:r,sum:u,qtyNumber:b,sumNumber:f}]})}}),n.length===0){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0438\u0437 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0441\u0442\u0440\u043E\u043A. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0444\u043E\u0440\u043C\u0430\u0442 Excel \u0444\u0430\u0439\u043B\u0430.");return}let i={...t.competitorSelections,[t.activeModalSku]:n};try{await ee({competitorSelections:i,parsedPrices:t.parsedPrices,uploadedFiles:t.uploadedFiles,lastUpdated:new Date().toISOString()},E),console.log("\u2705 \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440"),alert(`\u2705 \u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E ${n.length} \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432`)}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435:",o),alert("\u26A0\uFE0F \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E, \u043D\u043E \u043D\u0435 \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435")}y(o=>({...o,competitorSelections:i,activeModalSku:null}))},st=e=>{T(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},me=e=>{if(!e)return"\u041D\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0451\u043D";let s=i=>{let o=parseFloat(i.replace(",",".")),l=Math.round(o);return Math.abs(o-l)<.15?String(l):Number.isInteger(o)?String(o):o.toFixed(1).replace(/\.?0+$/,"")},a=[{regex:/(\d+[.,]?\d*)\s*(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,unit:"\u043B"},{regex:/(\d+[.,]?\d*)\s*(?=\s|\/|,|$|[^\w--])/i,unit:"\u043C\u043B"},{regex:/(\d+[.,]?\d*)\s*(?:)?(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,unit:"\u0433"},{regex:/(\d+[.,]?\d*)\s*(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,unit:"\u043A\u0433"}],n=e.match(/\s*(\d+)\s*[*x]\s*(\d+[.,]?\d*)\s*([-a-z]+)/i)||e.match(/(\d+)\s*[*x]\s*(\d+[.,]?\d*)\s*([-a-z]+)/i);if(n){let i=n[1],o=s(n[2]),l=n[3].toLowerCase();return`\u041D\u0430\u0431\u043E\u0440 ${i}\xD7${o}${l}`}for(let i of a){let o=e.match(i.regex);if(o)return`${s(o[1])} ${i.unit}`}return"\u041D\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0451\u043D"},Te=e=>{if(!e)return null;let s=[{regex:/(\d+[.,]?\d*)\s*(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,multiplier:1e3},{regex:/(\d+[.,]?\d*)\s*(?=\s|\/|,|$|[^\w--])/i,multiplier:1},{regex:/(\d+[.,]?\d*)\s*(?:)?(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,multiplier:1},{regex:/(\d+[.,]?\d*)\s*(?:)?(?:|)?(?=\s|\/|,|$|[^\w--])/i,multiplier:1e3}];for(let a of s){let n=e.match(a.regex);if(n)return parseFloat(n[1].replace(",","."))*a.multiplier}return null},nt=e=>({min:e*.95,max:e*1.05}),je=(e,s,a)=>{let n={},i=["\u0412\u041C\u041F\u0410\u0412\u0422\u041E","\u0420\u041C","\u0421\u043C\u0430\u0437\u043A\u0430.\u0440\u0443"];return(t.selectedType?a.filter(l=>l.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430===t.selectedType):a).forEach(l=>{let d=Te(l.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430);if(!d){console.log(`\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u044C \u043E\u0431\u044A\u0451\u043C \u0434\u043B\u044F: ${l.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430}`);return}let m=nt(d),c=[];for(let u=1;u<e.length;u++){let p=e[u],b=p[s.brand]?String(p[s.brand]).trim():"";if(i.some(S=>S.toLowerCase()===b.toLowerCase()))continue;let f=p[s.name]?String(p[s.name]):"",w=Te(f);if(w&&w>=m.min&&w<=m.max){let S=p[s.link]?String(p[s.link]).trim():"",A=ge(S);c.push({name:f,brand:b,link:S,qty:p[s.qty]||0,sum:p[s.sum]||0,originalIndex:u,sku:A||void 0,priceHistory:[]})}}let r=c.sort((u,p)=>{let b=typeof u.sum=="number"?u.sum:parseFloat(String(u.sum||"0").replace(/[^\d.-]/g,""))||0;return(typeof p.sum=="number"?p.sum:parseFloat(String(p.sum||"0").replace(/[^\d.-]/g,""))||0)-b}).slice(0,20);r.length>0&&(n[l.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]=r,console.log(`\u2705 ${l.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430} (${d}\u043C\u043B): \u043D\u0430\u0439\u0434\u0435\u043D\u043E ${r.length} \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 (\u043C\u0430\u043A\u0441. 20)`))}),n},be=e=>{if(!e)return null;let s=[/(\d{1,2})\s*[Ww]\s*[-]?\s*(\d{1,3})/,/(\d{1,2})[Ww](\d{1,3})/];for(let a of s){let n=e.match(a);if(n)return`${n[1]}W-${n[2]}`}return null},he=()=>t.selectedType?["\u041C\u043E\u0442\u043E\u0440\u043D\u044B\u0435 \u043C\u0430\u0441\u043B\u0430","\u0422\u0440\u0430\u043D\u0441\u043C\u0438\u0441\u0441\u0438\u043E\u043D\u043D\u044B\u0435 \u043C\u0430\u0441\u043B\u0430"].some(s=>t.selectedType?.toLowerCase().includes(s.toLowerCase())):!1,at=e=>{if(!V||!he())return[];let s=V,a=Y(s);if(a.name===-1||a.brand===-1||a.sum===-1)return[];let n={};for(let i=1;i<s.length;i++){let o=s[i];if((o[a.brand]?String(o[a.brand]).trim():"")!==e)continue;let d=o[a.name]?String(o[a.name]):"",m=be(d);if(!m)continue;let c=o[a.sum],r=typeof c=="number"?c:parseFloat(String(c||"0").replace(/[^\d.-]/g,""))||0;n[m]||(n[m]={count:0,totalSum:0}),n[m].count++,n[m].totalSum+=r}return Object.entries(n).map(([i,o])=>({name:i,count:o.count,totalSum:o.totalSum})).sort((i,o)=>o.totalSum-i.totalSum)},qe=()=>{if(!V)return[];let e=V,s=Y(e);if(s.brand===-1||s.sum===-1)return[];let a=["\u0412\u041C\u041F\u0410\u0412\u0422\u041E","\u0420\u041C","\u0421\u043C\u0430\u0437\u043A\u0430.\u0440\u0443"],n=[];if(t.filteredRows&&t.filteredRows.length>0)n=t.filteredRows;else for(let o=1;o<e.length;o++)n.push(o);let i={};return n.forEach(o=>{let l=e[o],d=l[s.brand]?String(l[s.brand]).trim():"";if(a.includes(d))return;let m=l[s.sum],c=typeof m=="number"?m:parseFloat(String(m||"0").replace(/[^\d.-]/g,""))||0;i[d]||(i[d]={count:0,totalSum:0}),i[d].count++,i[d].totalSum+=c}),Object.entries(i).map(([o,l])=>({name:o,count:l.count,totalSum:l.totalSum})).sort((o,l)=>l.totalSum-o.totalSum).slice(0,5)},Ae=(e,s)=>{if(!V)return[];let a=V,n=Y(a);if(n.name===-1||n.brand===-1||n.sum===-1)return[];let i=[];if(t.filteredRows&&t.filteredRows.length>0)i=t.filteredRows;else for(let l=1;l<a.length;l++)i.push(l);let o={};return i.forEach(l=>{let d=a[l];if((d[n.brand]?String(d[n.brand]).trim():"")!==e)return;let c=d[n.name]?String(d[n.name]):"";if(he()&&s&&be(c)!==s)return;let r=me(c),u=d[n.sum],p=typeof u=="number"?u:parseFloat(String(u||"0").replace(/[^\d.-]/g,""))||0;o[r]||(o[r]={count:0,totalSum:0}),o[r].count++,o[r].totalSum+=p}),Object.entries(o).map(([l,d])=>({name:l,count:d.count,totalSum:d.totalSum})).sort((l,d)=>d.totalSum-l.totalSum)},ye=()=>{if(!V)return[];let e=V,s=Y(e);if(s.name===-1||s.brand===-1||s.sum===-1)return[];let n=qe().map(r=>r.name),i=[];if(t.filteredRows&&t.filteredRows.length>0)i=t.filteredRows;else for(let r=1;r<e.length;r++)i.push(r);let o=he(),l=i.filter(r=>{let u=e[r],p=u[s.brand]?String(u[s.brand]).trim():"",b=u[s.name]?String(u[s.name]):"";return!(!n.includes(p)||P&&p!==P||o&&_&&be(b)!==_||L&&me(b)!==L)});if(o){let r={};l.forEach(b=>{let f=e[b],w=f[s.brand]?String(f[s.brand]).trim():"",S=f[s.name]?String(f[s.name]):"",A=be(S)||"\u0411\u0435\u0437 \u0432\u044F\u0437\u043A\u043E\u0441\u0442\u0438",D=me(S);r[w]||(r[w]={}),r[w][A]||(r[w][A]={}),r[w][A][D]||(r[w][A][D]=[]),r[w][A][D].push(b)});let u=[];return n.filter(b=>r[b]).forEach(b=>{let f=r[b];Object.values(f).forEach(w=>{Object.values(w).forEach(S=>{let A=S.map(D=>{let N=e[D][s.sum],x=typeof N=="number"?N:parseFloat(String(N||"0").replace(/[^\d.-]/g,""))||0;return{rowIndex:D,sum:x}}).sort((D,j)=>j.sum-D.sum).slice(0,5);u.push(...A.map(D=>D.rowIndex))})})}),u}let d={};l.forEach(r=>{let u=e[r],p=u[s.brand]?String(u[s.brand]).trim():"",b=u[s.name]?String(u[s.name]):"",f=me(b);d[p]||(d[p]={}),d[p][f]||(d[p][f]=[]),d[p][f].push(r)});let m=[];return n.filter(r=>d[r]).forEach(r=>{let u=d[r];Object.values(u).forEach(p=>{let b=p.map(f=>{let S=e[f][s.sum],A=typeof S=="number"?S:parseFloat(String(S||"0").replace(/[^\d.-]/g,""))||0;return{rowIndex:f,sum:A}}).sort((f,w)=>w.sum-f.sum).slice(0,5);m.push(...b.map(f=>f.rowIndex))})}),m},$t=()=>{let e=window.XLSX.utils.book_new(),s=se.map(n=>{let i=t.ozonData[n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],o=t.competitorSelections[n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]||[],l=t.ozonPrices[n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent,d=o.map(p=>{if(p.ozonCardPrice&&l){let f=(we(p.ozonCardPrice)-10)/(1-l);return`${Math.round(f*100)/100} \u20BD`}return"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"}),m=ae(t.parsedPrices,n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B),c=m?.price,r=c||i?.customer_price||"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445",u=c?` (\u0441\u043F\u0430\u0440\u0441\u0435\u043D\u043E ${m?.date})`:i?.customer_price?" (API)":"";return{\u0410\u0440\u0442\u0438\u043A\u0443\u043B:n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B,\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430:n.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430,"\u041E\u0431\u044B\u0447\u043D\u0430\u044F \u0446\u0435\u043D\u0430 Ozon":i?`${i.price} \u20BD`:"\u0422\u043E\u0432\u0430\u0440 \u0432 \u0430\u0440\u0445\u0438\u0432\u0435","\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card":r+u,"\u0421\u043E\u0438\u043D\u0432\u0435\u0441\u0442, %":l?`${(l*100).toFixed(1)}%`:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445","\u0412\u0438\u0434 \u0442\u043E\u0432\u0430\u0440\u0430":n.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430,"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B (\u0418\u043C\u0435\u043D\u0430)":o.map(p=>`${p.name} (${p.link})`).join(`
`),"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B (\u0411\u0440\u0435\u043D\u0434)":o.map(p=>p.brand).join(`
`),"\u0426\u0435\u043D\u044B \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 Ozon Card":o.map(p=>p.ozonCardPrice||"\u041D\u0435 \u0441\u043F\u0430\u0440\u0441\u0435\u043D\u0430").join(`
`),"\u0420\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0446\u0435\u043D\u044B":d.join(`
`),"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B (\u0428\u0442\u0443\u043A\u0438)":o.map(p=>p.qty).join(`
`),"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B (\u0421\u0443\u043C\u043C\u0430)":o.map(p=>p.sum).join(`
`),"\u0414\u0430\u0442\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F":o.map(p=>p.lastUpdated?new Date(p.lastUpdated).toLocaleString():"").join(`
`)}}),a=window.XLSX.utils.json_to_sheet(s);window.XLSX.utils.book_append_sheet(e,a,"Price Data"),window.XLSX.writeFile(e,`price_regulation_${new Date().toISOString().slice(0,10)}.xlsx`)},ot=async()=>{let e=prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u043D\u043E\u0432\u043E\u0433\u043E \u0444\u0430\u0439\u043B\u0430:",`data_${new Date().toISOString().slice(0,10)}`);if(e){let s=e.replace(/[^a-zA-Z0-9-_]/g,"_");R(s),y(a=>({...a,competitorSelections:{},uploadedFiles:{},parsedPrices:{}})),await de()}},Se=async e=>{try{let s=await Ce(e);s.success&&s.data?(R(e.replace(".json","")),y(a=>({...a,competitorSelections:s.data.competitorSelections||{},parsedPrices:s.data.parsedPrices||{},uploadedFiles:s.data.uploadedFiles||{}}))):alert(`\u0424\u0430\u0439\u043B "${e}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0438\u043B\u0438 \u043F\u0443\u0441\u0442`)}catch(s){alert(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430: ${s.message}`)}},rt=async e=>{if(confirm(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u0430\u0439\u043B "${e}"?`))try{await wt(e),await de(),E===e.replace(".json","")&&(R(te),y(s=>({...s,competitorSelections:{},uploadedFiles:{},parsedPrices:{}}))),alert(`\u0424\u0430\u0439\u043B "${e}" \u0443\u0434\u0430\u043B\u0451\u043D`)}catch(s){alert(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430: ${s.message}`)}},it=async()=>{try{let e=await vt();e.success&&(alert(`\u2705 \u0411\u044D\u043A\u0430\u043F \u0441\u043E\u0437\u0434\u0430\u043D: ${e.filename}
\u0420\u0430\u0437\u043C\u0435\u0440: ${(e.size/1024).toFixed(2)} KB`),await de())}catch(e){alert(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0431\u044D\u043A\u0430\u043F\u0430: ${e.message}`)}},ct=()=>{let e=Object.keys(t.competitorSelections).length,s=Object.values(t.competitorSelections).reduce((i,o)=>i+(Array.isArray(o)?o.length:0),0),a=0;Object.values(t.competitorSelections).forEach(i=>{Array.isArray(i)&&i.forEach(o=>{o.priceHistory&&(a+=o.priceHistory.length)})});let n=q.find(i=>i.name===`${E}.json`);alert(`\u{1F4CA} \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445:

\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0444\u0430\u0439\u043B: ${E}
\u0422\u043E\u0432\u0430\u0440\u043E\u0432 \u0441 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430\u043C\u0438: ${e}
\u0412\u0441\u0435\u0433\u043E \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432: ${s}
\u0417\u0430\u043F\u0438\u0441\u0435\u0439 \u0432 \u0438\u0441\u0442\u043E\u0440\u0438\u0438: ${a}
\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0445 Excel \u0444\u0430\u0439\u043B\u043E\u0432: ${Object.keys(t.uploadedFiles).length}
\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435: ${n?.lastUpdated?new Date(n.lastUpdated).toLocaleString():"\u043D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"}
\u0420\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430: ${n?(n.size/1024).toFixed(2)+" KB":"\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E"}
\u0412\u0441\u0435\u0433\u043E \u0444\u0430\u0439\u043B\u043E\u0432 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0435: ${q.length}`)},lt=async e=>{try{let s=await Ce(`daily_data_${e}`);s.success&&s.data?alert(`\u{1F4CA} \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0441\u0442\u043E\u0440\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0437\u0430 ${e}

\u0422\u043E\u0432\u0430\u0440\u043E\u0432: ${Object.keys(s.data.competitorSelections||{}).length}
\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432: ${Object.values(s.data.competitorSelections||{}).reduce((a,n)=>a+(Array.isArray(n)?n.length:0),0)}
\u0414\u0430\u0442\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F: ${new Date(s.data.timestamp).toLocaleString()}`):alert(`\u0418\u0441\u0442\u043E\u0440\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0437\u0430 ${e} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B`)}catch(s){alert(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0441\u0442\u043E\u0440\u0438\u0447\u0435\u0441\u043A\u0438\u0445 \u0434\u0430\u043D\u043D\u044B\u0445: ${s.message}`)}},dt=ue(()=>Object.values(t.competitorSelections).some(e=>Array.isArray(e)&&e.length>0),[t.competitorSelections]),mt=ue(()=>{let e={};return t.vmpData.forEach(s=>{s.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430&&(e[s.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430]=(e[s.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430]||0)+1)}),Object.entries(e).sort((s,a)=>a[1]-s[1])},[t.vmpData]),se=ue(()=>{let e=t.vmpData;return t.selectedType&&(e=e.filter(s=>s.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430===t.selectedType)),e=e.filter(s=>{let a=t.ozonData[s.\u0410\u0440\u0442\u0438\u043A\u0443\u043B];return a&&!a.is_archived}),e},[t.vmpData,t.selectedType,t.ozonData]),ut=t.activeModalSku?t.vmpData.find(e=>e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B===t.activeModalSku):null,Ee=t.activeModalSku?t.ozonData[t.activeModalSku]:null,Ue=Ee?.type_id?`type_${Ee.type_id}`:null,V=Ue?t.uploadedFiles[Ue]:null,{visibleProducts:Be,hiddenProducts:xe}=ue(()=>{let e=[],s=[],a=_e(t.parsedPrices);return se.forEach(n=>{let i=t.ozonData[n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],o=i?.sku?String(i.sku):null,l=o?t.salesData[o]:null,d=t.competitorSelections[n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]||[],m=i?.type_id?`type_${i.type_id}`:null,c=m&&t.uploadedFiles[m],u=!!ae(t.parsedPrices,n.\u0410\u0440\u0442\u0438\u043A\u0443\u043B),p=l&&(l.qty>0||l.sum>0),b=d.length>0;c&&b&&p?e.push(n):s.push(n)}),{visibleProducts:e,hiddenProducts:s}},[se,t.ozonData,t.salesData,t.competitorSelections,t.parsedPrices,t.uploadedFiles]),pt=ue(()=>{let e={},s=new Set(Be.map(a=>a.\u0410\u0440\u0442\u0438\u043A\u0443\u043B));return se.forEach(a=>{let i=t.ozonData[a.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.type_id,o=i?t.ozonCategories[i]||"\u0422\u0438\u043F \u043D\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0451\u043D":"\u0411\u0435\u0437 \u0442\u0438\u043F\u0430",l=i?.toString()||"no-type";e[l]||(e[l]={categoryId:i||null,categoryName:o,items:[],visibleItems:[]}),e[l].items.push(a),s.has(a.\u0410\u0440\u0442\u0438\u043A\u0443\u043B)&&e[l].visibleItems.push(a)}),Object.values(e).sort((a,n)=>!a.categoryId&&n.categoryId?1:a.categoryId&&!n.categoryId?-1:a.categoryName.localeCompare(n.categoryName,"ru"))},[se,Be,t.ozonData,t.ozonCategories]);return t.loading?React.createElement("div",{className:"text-center mt-5"},React.createElement("div",{className:"spinner-border text-primary",role:"status"}),React.createElement("p",{className:"mt-2"},"Loading data...")):t.error?React.createElement("div",{className:"alert alert-danger m-4"},t.error):React.createElement("div",{className:"container-fluid pb-5"},React.createElement("h1",{className:"mb-4 text-center"},"\u0420\u0435\u0433\u0443\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0446\u0435\u043D"),t.usingFallback&&React.createElement("div",{className:"alert alert-warning mb-3"},React.createElement("strong",null,"\u041F\u0440\u0438\u043C\u0435\u0447\u0430\u043D\u0438\u0435:")," \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u044B \u043A\u044D\u0448\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 (data_cache.json), \u0442\u0430\u043A \u043A\u0430\u043A \u043F\u0440\u044F\u043C\u043E\u0439 \u0434\u043E\u0441\u0442\u0443\u043F \u043A API \u043E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D."),M.total>0&&React.createElement("div",{className:"alert alert-info mb-3"},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("div",null,React.createElement("strong",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 Ozon \u0434\u0430\u043D\u043D\u044B\u0445:")," ",M.stage),React.createElement("div",null,M.current," / ",M.total)),React.createElement("div",{className:"progress mt-2"},React.createElement("div",{className:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:`${M.current/M.total*100}%`}},Math.round(M.current/M.total*100),"%"))),React.createElement("div",{className:"alert alert-info mb-3",style:{display:"none"}},React.createElement("div",{className:"d-flex justify-content-between align-items-center"},React.createElement("div",null,React.createElement("strong",null,"\u0424\u0430\u0439\u043B \u0434\u0430\u043D\u043D\u044B\u0445:"),React.createElement("select",{className:"form-select form-select-sm d-inline-block w-auto mx-2",value:E,onChange:e=>Se(e.target.value)},React.createElement("option",{value:te},"\u041E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u0444\u0430\u0439\u043B"),q.map((e,s)=>React.createElement("option",{key:s,value:e.name.replace(".json","")},e.name," (",e.itemCount," \u0442\u043E\u0432\u0430\u0440\u043E\u0432)"))),ve&&React.createElement("span",{className:"text-muted ms-2"},"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435...")),React.createElement("div",{className:"btn-group btn-group-sm"},React.createElement("button",{className:"btn btn-outline-primary",onClick:()=>Ke(!Fe)},"\u{1F4C1} \u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0444\u0430\u0439\u043B\u0430\u043C\u0438"),React.createElement("button",{className:"btn btn-outline-success",onClick:ot},"\u2795 \u041D\u043E\u0432\u044B\u0439 \u0444\u0430\u0439\u043B"),React.createElement("button",{className:"btn btn-outline-warning",onClick:ct},"\u{1F4CA} \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430"),React.createElement("button",{className:"btn btn-outline-secondary",onClick:it},"\u{1F4BE} \u0411\u044D\u043A\u0430\u043F")))),Fe&&React.createElement("div",{className:"card mb-3"},React.createElement("div",{className:"card-header"},React.createElement("h5",{className:"mb-0"},"\u{1F4C1} \u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u0434\u0430\u043D\u043D\u044B\u0445")),React.createElement("div",{className:"card-body"},React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430"),React.createElement("th",null,"\u0420\u0430\u0437\u043C\u0435\u0440"),React.createElement("th",null,"\u0418\u0437\u043C\u0435\u043D\u0451\u043D"),React.createElement("th",null,"\u0422\u043E\u0432\u0430\u0440\u043E\u0432"),React.createElement("th",null,"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432"),React.createElement("th",null,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"))),React.createElement("tbody",null,q.map((e,s)=>React.createElement("tr",{key:s,className:E===e.name.replace(".json","")?"table-active":""},React.createElement("td",null,e.name),React.createElement("td",null,(e.size/1024).toFixed(2)," KB"),React.createElement("td",null,new Date(e.modified).toLocaleDateString()),React.createElement("td",null,e.itemCount),React.createElement("td",null,e.competitorCount),React.createElement("td",null,React.createElement("button",{className:"btn btn-sm btn-outline-primary me-1",onClick:()=>Se(e.name.replace(".json","")),disabled:E===e.name.replace(".json","")},"\u{1F4C2} \u041E\u0442\u043A\u0440\u044B\u0442\u044C"),e.name.startsWith("daily_data_")&&React.createElement("button",{className:"btn btn-sm btn-outline-info me-1",onClick:()=>lt(e.name.replace("daily_data_","").replace(".json",""))},"\u{1F4C5} \u0418\u0441\u0442\u043E\u0440\u0438\u044F"),React.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>rt(e.name)},"\u{1F5D1}\uFE0F \u0423\u0434\u0430\u043B\u0438\u0442\u044C"))))))),React.createElement("div",{className:"text-end"},React.createElement("button",{className:"btn btn-sm btn-secondary",onClick:de},"\u{1F504} \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A")))),React.createElement("div",{className:"tag-cloud"},React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3"},React.createElement("h5",{className:"m-0"},"\u0424\u0438\u043B\u044C\u0442\u0440 \u043F\u043E \u0432\u0438\u0434\u0443 \u0442\u043E\u0432\u0430\u0440\u0430:"),React.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>Re(null)},"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0444\u0438\u043B\u044C\u0442\u0440")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},mt.map(([e,s])=>React.createElement("span",{key:e,className:`badge rounded-pill border tag p-2 ${t.selectedType===e?"active":"bg-light text-dark"}`,onClick:()=>Re(e)},e," (",s,")")))),React.createElement("div",{className:"mb-3 d-flex gap-2 flex-wrap"},dt&&React.createElement("button",{className:"btn btn-warning",onClick:Ze,disabled:t.isParsingPrices},t.isParsingPrices?React.createElement(React.Fragment,null,React.createElement("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"\u041F\u0430\u0440\u0441\u0438\u043D\u0433..."):"\u041F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0446\u0435\u043D\u044B \u043F\u043E Ozon Card")),React.createElement("div",{className:"main-table-container"},React.createElement("table",{className:"product-table table-hover align-middle"},React.createElement("thead",{className:"table-light sticky-top"},React.createElement("tr",null,React.createElement("th",{style:{width:"30px"},title:"\u041F\u0440\u0435\u0434\u0443\u043F\u0440\u0435\u0436\u0434\u0435\u043D\u0438\u0435: \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442 \u0434\u0435\u0448\u0435\u0432\u043B\u0435 \u0438 \u043F\u0440\u043E\u0434\u0430\u0451\u0442 \u0431\u043E\u043B\u044C\u0448\u0435"},"\u26A0\uFE0F"),React.createElement("th",{style:{width:"80px"}},"\u0424\u043E\u0442\u043E"),React.createElement("th",{style:{width:"25%"}},"\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430"),React.createElement("th",{style:{width:"10%"}},"\u0426\u0435\u043D\u0430 Ozon \u0437\u0430\u043B\u0438\u0432\u043E\u0447\u043D\u0430\u044F"),React.createElement("th",{style:{width:"15%"}},"\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card"),React.createElement("th",{style:{width:"10%"}},"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442"),React.createElement("th",{style:{width:"12%"}},"\u0421\u0443\u043C\u043C\u0430 \u0437\u0430\u043A\u0430\u0437\u0430"),React.createElement("th",{style:{width:"100px"}},"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"))),React.createElement("tbody",null,pt.map((e,s)=>{let a=t.collapsedCategories[e.categoryId?.toString()||"no-type"],n=`type_${e.categoryId||"no-type"}`,i=t.uploadedFiles[n];return React.createElement(React.Fragment,{key:`group-${e.categoryId||"no-type"}-${s}`},React.createElement("tr",{className:"table-light"},React.createElement("td",{colSpan:8,className:"py-2 px-3",style:{background:"#f8f9fa"}},React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("div",{className:"d-flex align-items-center",style:{cursor:"pointer"},onClick:()=>{let o=e.categoryId?.toString()||"no-type";y(l=>({...l,collapsedCategories:{...l.collapsedCategories,[o]:!l.collapsedCategories[o]}}))}},React.createElement("i",{className:`bi ${a?"bi-chevron-right":"bi-chevron-down"} me-2 text-muted`}),React.createElement("span",{className:"text-muted",style:{fontSize:"0.9rem"}},e.categoryName),React.createElement("span",{className:"badge bg-light text-muted border ms-2"},e.visibleItems.length>0?`${e.visibleItems.length} / ${e.items.length}`:e.items.length)),React.createElement("div",{className:"d-flex align-items-center gap-2",onClick:o=>o.stopPropagation()},i?React.createElement("span",{className:"text-muted small"},React.createElement("i",{className:"bi bi-check"})," \u0424\u0430\u0439\u043B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D (",i.length-1," \u0441\u0442\u0440\u043E\u043A)"):React.createElement("span",{className:"text-muted small"},"\u041D\u0435\u0442 \u0444\u0430\u0439\u043B\u0430"),React.createElement("label",{className:"btn btn-sm btn-outline-secondary mb-0",style:{cursor:"pointer"}},React.createElement("i",{className:"bi bi-upload me-1"}),i?"\u0417\u0430\u043C\u0435\u043D\u0438\u0442\u044C":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C XLS",React.createElement("input",{type:"file",accept:".xls,.xlsx",style:{display:"none"},onChange:o=>{let l=o.target.files?.[0];if(!l)return;let d=new FileReader;d.onload=m=>{try{let c=new Uint8Array(m.target?.result),r=window.XLSX.read(c,{type:"array"}),u=r.Sheets[r.SheetNames[0]],p=window.XLSX.utils.sheet_to_json(u,{header:1}),b=Y(p),f=e.items,w=je(p,b,f),S={...t.competitorSelections};Object.entries(w).forEach(([N,x])=>{S[N]=x});let A=Object.keys(w).length,D=Object.values(w).reduce((N,x)=>N+x.length,0),j={...t.uploadedFiles,[n]:p};ee({competitorSelections:S,parsedPrices:t.parsedPrices,uploadedFiles:j,lastUpdated:new Date().toISOString()},E).then(()=>{y(N=>({...N,uploadedFiles:j,competitorSelections:S})),console.log(`\u2705 \u0424\u0430\u0439\u043B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D \u0434\u043B\u044F ${e.categoryName}: ${p.length-1} \u0441\u0442\u0440\u043E\u043A, ${A} \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0441 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430\u043C\u0438 (${D} \u0432\u0441\u0435\u0433\u043E)`)})}catch(c){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F Excel:",c),alert("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430 Excel")}},d.readAsArrayBuffer(l),o.target.value=""}})))))),!a&&e.visibleItems.map((o,l)=>{let d=t.ozonData[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],m=d?.primary_image||d?.images?.[0],c=t.competitorSelections[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]||[],r=i,p=ae(t.parsedPrices,o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B)?.price,b=d?.sku?String(d.sku):null,f=b?t.salesData[b]:null,w=t.ozonPrices[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent||0,S=f?.sum?f.sum*(1-w):0,D=(p&&parseFloat(String(p).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9,j=c.some(N=>{let h=(N.ozonCardPrice&&parseFloat(String(N.ozonCardPrice).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9,g=typeof N.qty=="number"?N.qty:parseFloat(String(N.qty||"0").replace(/[^\d.-]/g,""))||0,k=typeof N.sum=="number"?N.sum:parseFloat(String(N.sum||"0").replace(/[^\d.-]/g,""))||0;return D>0&&h>0&&h<D&&(f?.qty&&g>f.qty||S>0&&k>S)});return React.createElement(React.Fragment,{key:`${o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B}-${l}`},React.createElement("tr",{className:`product-row ${j?"table-warning":""}`},React.createElement("td",{className:"text-center"},j&&React.createElement("i",{className:"bi bi-exclamation-triangle-fill text-danger",title:"\u0415\u0441\u0442\u044C \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442 \u0434\u0435\u0448\u0435\u0432\u043B\u0435 \u0441 \u0431\u043E\u043B\u044C\u0448\u0438\u043C\u0438 \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u043C\u0438!",style:{fontSize:"1.2rem"}})),React.createElement("td",null,m?React.createElement("img",{src:m,className:"product-img shadow-sm",alt:o.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430,onClick:()=>C(m)}):React.createElement("span",{className:"text-muted small"},"\u041D\u0435\u0442 \u0444\u043E\u0442\u043E")),React.createElement("td",null,React.createElement("div",{className:"fw-medium"},o.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430),React.createElement("div",{className:"small text-muted"},o.\u0412\u0438\u0434\u0422\u043E\u0432\u0430\u0440\u0430),React.createElement("div",{className:"small"},d?.sku?React.createElement("a",{href:`https://www.ozon.ru/product/${d.sku}`,target:"_blank",rel:"noreferrer",className:"text-decoration-none text-muted"},React.createElement("i",{className:"bi bi-link"})," \u0421\u0441\u044B\u043B\u043A\u0430"):React.createElement("span",{className:"text-muted"},"\u0410\u0440\u0442: ",o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B))),React.createElement("td",null,d?React.createElement("div",{className:"price-display price-regular"},d.price," \u20BD",t.ozonPrices[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent&&React.createElement("div",{className:"small soinvest"},React.createElement("i",{className:"bi bi-percent text-muted mt-1"})," \u0421\u043E\u0438\u043D\u0432\u0435\u0441\u0442: ",(t.ozonPrices[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent*100).toFixed(1),"%")):React.createElement("span",{className:"text-danger"},"\u0410\u0440\u0445\u0438\u0432/\u041D\u0435\u0442")),React.createElement("td",null,(()=>{let N=ae(t.parsedPrices,o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B),x=N?.price,h=N?.date,g=k=>{let $=parseFloat(k.replace(/[^\d.,]/g,"").replace(",","."))||0;if($<=0)return k;let O=$*.9;return`${new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(O)} \u20BD`};if(x){let k=new Date().toISOString().split("T")[0],$=h===k;return React.createElement("div",{className:"price-display price-card"},g(x),React.createElement("div",{className:"small text-muted"},React.createElement("i",{className:"bi bi-check-circle"})," ",$?"\u0421\u043F\u0430\u0440\u0441\u0435\u043D\u043E":h))}else return d?.customer_price?React.createElement("div",{className:"price-display price-card"},g(d.customer_price),React.createElement("div",{className:"small text-muted"},React.createElement("i",{className:"bi bi-cloud"})," API - 10%")):React.createElement("span",{className:"text-muted small"},"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445")})()),React.createElement("td",null,(()=>{let N=d?.sku?String(d.sku):null,x=N?t.salesData[N]:null;return x?.qty?React.createElement("span",null,new Intl.NumberFormat("ru-RU").format(x.qty)):React.createElement("span",{className:"text-muted"},"\u2014")})()),React.createElement("td",null,(()=>{let N=d?.sku?String(d.sku):null,x=N?t.salesData[N]:null,h=t.ozonPrices[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent||0;if(x?.sum){let g=x.sum*(1-h),k=`\u0421\u0443\u043C\u043C\u0430 \u0438\u0437 API: ${new Intl.NumberFormat("ru-RU").format(x.sum)} \u20BD
\u0421\u043E\u0438\u043D\u0432\u0435\u0441\u0442: ${(h*100).toFixed(1)}%
\u0424\u043E\u0440\u043C\u0443\u043B\u0430: ${new Intl.NumberFormat("ru-RU").format(x.sum)} \xD7 (1 - ${(h*100).toFixed(1)}%) = ${new Intl.NumberFormat("ru-RU").format(g)} \u20BD`;return React.createElement("span",{title:k,style:{cursor:"help"}},new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(g)," \u20BD")}return React.createElement("span",{className:"text-muted"},"\u2014")})()),React.createElement("td",null,React.createElement("button",{className:`btn btn-sm ${c.length>0,"btn-outline-secondary"}`,disabled:!r,title:r?"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432":"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0412\u0438\u0434 \u0422\u043E\u0432\u0430\u0440\u0430 \u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 Excel",onClick:()=>et(o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B,c)},c.length>0?React.createElement(React.Fragment,null,"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B: ",c.length):React.createElement(React.Fragment,null,React.createElement("i",{className:"bi bi-plus"})," \u0412\u044B\u0431\u0440\u0430\u0442\u044C")))),c.length>0&&React.createElement("tr",null,React.createElement("td",{colSpan:8,className:"p-0 border-0"},React.createElement("div",{className:"competitors-table-container slide-down mb-4"},React.createElement("div",{className:"d-flex"},React.createElement("div",{className:"flex-grow-1"},React.createElement("table",{className:"competitors-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:"30px"}}),React.createElement("th",{style:{width:"80px"}},"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),React.createElement("th",{style:{width:"25%"}},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430"),React.createElement("th",{style:{width:"10%"}}),React.createElement("th",{style:{width:"15%"}},"\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card"),React.createElement("th",{style:{width:"10%"}},"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442"),React.createElement("th",{style:{width:"12%"}},"\u0421\u0443\u043C\u043C\u0430 \u0437\u0430\u043A\u0430\u0437\u0430"))),React.createElement("tbody",null,(()=>{let N=t.expandedProducts[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],x=[...c].sort((g,k)=>{let $=typeof g.sum=="number"?g.sum:parseFloat(String(g.sum||"0").replace(/[^\d.-]/g,""))||0;return(typeof k.sum=="number"?k.sum:parseFloat(String(k.sum||"0").replace(/[^\d.-]/g,""))||0)-$}),h=N?x:x.slice(0,3);return React.createElement(React.Fragment,null,h.map((g,k)=>{let $=c.findIndex(ie=>ie===g),Q=ae(t.parsedPrices,o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B)?.price,K=t.ozonData[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],re=K?.sku?String(K.sku):null,ne=re?t.salesData[re]:null,fe=t.ozonPrices[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent||0,J=ne?.sum?ne.sum*(1-fe):0,G=(Q&&parseFloat(String(Q).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9,$e=(g.ozonCardPrice&&parseFloat(String(g.ozonCardPrice).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9,bt=typeof g.qty=="number"?g.qty:parseFloat(String(g.qty||"0").replace(/[^\d.-]/g,""))||0,ht=typeof g.sum=="number"?g.sum:parseFloat(String(g.sum||"0").replace(/[^\d.-]/g,""))||0,Me=G>0&&$e>0&&$e<G&&(ne?.qty&&bt>ne.qty||J>0&&ht>J);return React.createElement("tr",{key:`${o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B}-competitor-${k}`,className:Me?"table-danger":""},React.createElement("td",{className:"text-center"},Me&&React.createElement("i",{className:"bi bi-exclamation-triangle-fill text-danger",title:`\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442 \u0434\u0435\u0448\u0435\u0432\u043B\u0435 (${$e} \u20BD < ${G} \u20BD) \u0438 \u043F\u0440\u043E\u0434\u0430\u0451\u0442 \u0431\u043E\u043B\u044C\u0448\u0435!`,style:{fontSize:"1rem"}})),React.createElement("td",null,React.createElement("div",{className:"d-flex gap-1"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ie=>{ie.stopPropagation(),Ge(g,o.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430)},title:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0438\u0441\u0442\u043E\u0440\u0438\u044E \u0438 \u0433\u0440\u0430\u0444\u0438\u043A\u0438"},React.createElement("i",{className:"bi bi-graph-up"})),React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:ie=>{ie.stopPropagation(),Ye(o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B,$)},title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430"},React.createElement("i",{className:"bi bi-x-lg"})))),React.createElement("td",null,React.createElement("div",{title:String(g.name),style:{fontSize:"0.9rem"}},String(g.name).substring(0,80),String(g.name).length>80?"...":""),React.createElement("div",{className:"small text-muted"},React.createElement("a",{href:g.link,target:"_blank",rel:"noreferrer",className:"text-decoration-none text-muted"},React.createElement("i",{className:"bi bi-link-45deg"})," Ozon"),React.createElement("span",{className:"ms-2"},g.brand))),React.createElement("td",null),React.createElement("td",null,g.ozonCardPrice?(()=>{let Le=(parseFloat(String(g.ozonCardPrice).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9;return React.createElement("span",{className:"badge badge-success",title:`\u0421\u043F\u0430\u0440\u0441\u0435\u043D\u043E: ${g.ozonCardPrice}, -10% = ${Le.toFixed(0)} \u20BD
\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u043E: ${g.lastUpdated?new Date(g.lastUpdated).toLocaleString():"\u043D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"}`},new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Le)," \u20BD")})():React.createElement("span",{className:"text-muted small"},"\u041D\u0435 \u0441\u043F\u0430\u0440\u0441\u0435\u043D\u0430")),React.createElement("td",{className:"text-center"},g.qty&&g.qty!==""&&g.qty!==0?React.createElement("span",null,g.qty):React.createElement("span",{className:"text-muted"},"\u2014")),React.createElement("td",{className:"text-end"},g.sum&&g.sum!==""&&g.sum!==0?React.createElement("span",null,g.sum," \u20BD"):React.createElement("span",{className:"text-muted"},"\u2014")))}),x.length>3&&React.createElement("tr",null,React.createElement("td",{colSpan:7,className:"text-center border-top-0"},React.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:g=>{g.stopPropagation(),y(k=>({...k,expandedProducts:{...k.expandedProducts,[o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]:!N}}))}},N?React.createElement(React.Fragment,null,React.createElement("i",{className:"bi bi-chevron-up"})," \u0421\u043A\u0440\u044B\u0442\u044C (",x.length-3,")"):React.createElement(React.Fragment,null,React.createElement("i",{className:"bi bi-chevron-down"})," \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0441\u0435 (",x.length,")")))))})()))),(()=>{let x=ae(t.parsedPrices,o.\u0410\u0440\u0442\u0438\u043A\u0443\u043B)?.price,h=c.length>0&&c.every($=>$.ozonCardPrice&&$.ozonCardPrice!=="");if(!x||!h)return React.createElement("div",{className:"ms-3 p-3 bg-light rounded text-center",style:{minWidth:"150px",opacity:.5}},React.createElement("div",{className:"small text-muted mb-1"},"\u0421\u0440\u0435\u0434\u043D\u0435\u0432\u0437\u0432\u0435\u0448\u0435\u043D\u043D\u0430\u044F \u0446\u0435\u043D\u0430"),React.createElement("div",{className:"fs-6 text-muted"},React.createElement("i",{className:"bi bi-hourglass-split"}),React.createElement("div",{className:"small mt-1"},"\u041E\u0436\u0438\u0434\u0430\u043D\u0438\u0435 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430")));let g=0,k=0;if(c.forEach($=>{let O=typeof $.qty=="number"?$.qty:parseFloat(String($.qty||"0").replace(/[^\d.-]/g,""))||0,K=($.ozonCardPrice&&parseFloat(String($.ozonCardPrice).replace(/[^\d.,]/g,"").replace(",","."))||0)*.9;O>0&&K>0&&(g+=O,k+=O*K)}),g>0){let $=k/g,O=$*.98;return React.createElement("div",{className:"ms-3 p-3 bg-light rounded text-center",style:{minWidth:"180px"}},React.createElement("div",{className:"small text-muted mb-1"},"\u0421\u0440\u0435\u0434\u043D\u0435\u0432\u0437\u0432\u0435\u0448\u0435\u043D\u043D\u0430\u044F"),React.createElement("div",{className:"text-muted",style:{fontSize:"0.9rem"}},new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format($)," \u20BD"),React.createElement("div",{className:"small text-muted mt-2 mb-1"},"\u0420\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u043E\u0432\u0430\u043D\u043D\u0430\u044F"),React.createElement("div",{className:"fw-medium",style:{fontSize:"1.25rem"}},new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(O)," \u20BD"),React.createElement("div",{className:"small text-muted mt-1",style:{opacity:.7}},"(\u22122%)"))}return React.createElement("div",{className:"ms-3 p-3 bg-light rounded text-center",style:{minWidth:"150px"}},React.createElement("div",{className:"small text-muted mb-1"},"\u0421\u0440\u0435\u0434\u043D\u0435\u0432\u0437\u0432\u0435\u0448\u0435\u043D\u043D\u0430\u044F \u0446\u0435\u043D\u0430"),React.createElement("div",{className:"fs-4 text-muted"},"\u2014"))})())))),c.length===0&&React.createElement("tr",null,React.createElement("td",{colSpan:8,className:"p-0 border-0"},React.createElement("div",{className:"competitors-empty"},React.createElement("i",{className:"bi bi-people"}),React.createElement("div",null,"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u044B")))))}))}))),xe.length>0&&React.createElement("details",{className:"mt-4"},React.createElement("summary",{className:"cursor-pointer text-muted mb-2 p-2 bg-light rounded"},React.createElement("i",{className:"bi bi-eye-slash me-2"}),"\u0421\u043A\u0440\u044B\u0442\u044B\u0435 \u0442\u043E\u0432\u0430\u0440\u044B (",xe.length,") \u2014",(()=>{let e=t.selectedType&&t.uploadedFiles[t.selectedType],s=_e(t.parsedPrices);return e?s?"\u0431\u0435\u0437 \u0441\u043F\u0430\u0440\u0441\u0435\u043D\u043D\u043E\u0439 \u0446\u0435\u043D\u044B, \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 \u0438\u043B\u0438 \u043F\u0440\u043E\u0434\u0430\u0436":"\u0431\u0435\u0437 \u043F\u0440\u043E\u0434\u0430\u0436":"\u0444\u0430\u0439\u043B \u043D\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D"})()),React.createElement("table",{className:"product-table table-hover align-middle mt-2",style:{opacity:.7}},React.createElement("thead",{className:"table-light"},React.createElement("tr",null,React.createElement("th",{style:{width:"80px"}},"\u0424\u043E\u0442\u043E"),React.createElement("th",{style:{minWidth:"200px"}},"\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430"),React.createElement("th",null,"\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card"),React.createElement("th",{style:{width:"100px"}},"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442"),React.createElement("th",{style:{width:"120px"}},"\u0421\u0443\u043C\u043C\u0430 \u0437\u0430\u043A\u0430\u0437\u0430"),React.createElement("th",null,"\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B"),React.createElement("th",null,"\u041F\u0440\u0438\u0447\u0438\u043D\u0430 \u0441\u043A\u0440\u044B\u0442\u0438\u044F"))),React.createElement("tbody",null,xe.map((e,s)=>{let a=t.ozonData[e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B],n=a?.primary_image||a?.images?.[0],i=a?.sku?String(a.sku):null,o=i?t.salesData[i]:null,l=t.competitorSelections[e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]||[],d=ae(t.parsedPrices,e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B),m=[],c=t.selectedType&&t.uploadedFiles[t.selectedType],r=_e(t.parsedPrices);return c?r?(d||m.push(a?.customer_price?"\u0426\u0435\u043D\u0430 \u0438\u0437 API (\u043D\u0435 \u0441\u043F\u0430\u0440\u0441\u0435\u043D\u0430)":"\u041D\u0435\u0442 \u0446\u0435\u043D\u044B"),(!o||o.qty===0&&o.sum===0)&&m.push("\u041D\u0435\u0442 \u043F\u0440\u043E\u0434\u0430\u0436"),l.length===0&&m.push("\u041D\u0435\u0442 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432")):(!o||o.qty===0&&o.sum===0)&&m.push("\u041D\u0435\u0442 \u043F\u0440\u043E\u0434\u0430\u0436"):m.push("\u0424\u0430\u0439\u043B \u043D\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D"),React.createElement("tr",{key:`hidden-${e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B}-${s}`,className:"text-muted"},React.createElement("td",null,n?React.createElement("img",{src:n,className:"product-img shadow-sm",alt:e.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430,style:{width:"40px",height:"40px"}}):React.createElement("span",{className:"text-muted small"},"\u2014")),React.createElement("td",null,React.createElement("small",null,e.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430),React.createElement("div",{className:"small"},a?.sku?React.createElement("a",{href:`https://www.ozon.ru/product/${a.sku}`,target:"_blank",rel:"noreferrer",className:"text-decoration-none text-muted"},React.createElement("i",{className:"bi bi-link"})," \u0421\u0441\u044B\u043B\u043A\u0430"):React.createElement("span",null,"\u0410\u0440\u0442: ",e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B))),React.createElement("td",null,(()=>{let u=d?.price,p=b=>{let f=parseFloat(b.replace(/[^\d.,]/g,"").replace(",","."))||0;if(f<=0)return b;let w=f*.9;return`${new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)} \u20BD`};return u?React.createElement("small",null,p(u)):a?.customer_price?React.createElement("small",null,p(a.customer_price)):React.createElement("small",{className:"text-muted"},"\u2014")})()),React.createElement("td",null,o?.qty?React.createElement("small",null,new Intl.NumberFormat("ru-RU").format(o.qty)):React.createElement("small",{className:"text-muted"},"\u2014")),React.createElement("td",null,o?.sum?React.createElement("small",null,new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o.sum*(1-(t.ozonPrices[e.\u0410\u0440\u0442\u0438\u043A\u0443\u043B]?.discount_percent||0)))," \u20BD"):React.createElement("small",{className:"text-muted"},"\u2014")),React.createElement("td",null,l.length>0?React.createElement("small",null,l.length," \u0448\u0442"):React.createElement("small",{className:"text-muted"},"\u2014")),React.createElement("td",null,React.createElement("small",{className:"text-muted"},m.join(", "))))}))))),t.selectedType&&Object.keys(t.competitorSelections).some(e=>se.some(s=>s.\u0410\u0440\u0442\u0438\u043A\u0443\u043B===e&&t.competitorSelections[e]?.length>0))&&React.createElement("div",{className:"mb-3"},React.createElement("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>{if(!confirm('\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 "'+t.selectedType+'"?'))return;let e=se.map(a=>a.\u0410\u0440\u0442\u0438\u043A\u0443\u043B),s={...t.competitorSelections};e.forEach(a=>{delete s[a]}),ee({competitorSelections:s,parsedPrices:t.parsedPrices,uploadedFiles:t.uploadedFiles,lastUpdated:new Date().toISOString()},E).then(()=>{y(a=>({...a,competitorSelections:s})),alert('\u0421\u043F\u0438\u0441\u043E\u043A \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 \u043E\u0447\u0438\u0449\u0435\u043D \u0434\u043B\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 "'+t.selectedType+'"')})}},React.createElement("i",{className:"bi bi-trash"})," \u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435\u0445 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432")),v&&React.createElement("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:1050},onClick:()=>C(null)},React.createElement("div",{className:"position-relative"},React.createElement("img",{src:v,style:{maxHeight:"90vh",maxWidth:"90vw"},alt:"Large preview"}),React.createElement("button",{className:"btn btn-close btn-close-white position-absolute top-0 end-0 m-2",onClick:()=>C(null)}))),Z.competitor&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050}},React.createElement("div",{className:"modal-dialog modal-xl modal-dialog-scrollable"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},"\u{1F4CA} \u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0430"),React.createElement("button",{type:"button",className:"btn-close",onClick:()=>Ne({competitor:null,productName:""})})),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"row mb-4"},React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"p-3 bg-light rounded"},React.createElement("h6",null,"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u0435:"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement("p",{className:"mb-1"},React.createElement("strong",null,"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435:")," ",Z.competitor.name),React.createElement("p",{className:"mb-1"},React.createElement("strong",null,"\u0422\u043E\u0432\u0430\u0440:")," ",Z.productName)),React.createElement("div",{className:"col-md-6"},React.createElement("p",{className:"mb-1"},React.createElement("strong",null,"\u0411\u0440\u0435\u043D\u0434:")," ",Z.competitor.brand),React.createElement("p",{className:"mb-0"},React.createElement("strong",null,"\u0421\u0441\u044B\u043B\u043A\u0430:"),React.createElement("a",{href:Z.competitor.link,target:"_blank",rel:"noopener noreferrer",className:"ms-2"},React.createElement("i",{className:"bi bi-link"})," \u041F\u0435\u0440\u0435\u0439\u0442\u0438"))))))),React.createElement("div",{className:"row mb-4"},React.createElement("div",{className:"col-md-12"},React.createElement("h6",{className:"mb-3"},"\u{1F4C8} \u0413\u0440\u0430\u0444\u0438\u043A\u0438 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0439"),React.createElement(Nt,{priceHistory:Z.competitor.priceHistory}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-header"},React.createElement("h6",{className:"mb-0"},"\u{1F4CB} \u0422\u0430\u0431\u043B\u0438\u0446\u0430 \u0438\u0441\u0442\u043E\u0440\u0438\u0438")),React.createElement("div",{className:"card-body"},Z.competitor.priceHistory&&Z.competitor.priceHistory.length>0?React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-sm table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"\u0414\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F"),React.createElement("th",null,"\u0426\u0435\u043D\u0430 \u043F\u043E Ozon Card"),React.createElement("th",null,"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442"),React.createElement("th",null,"\u0421\u0443\u043C\u043C\u0430 \u0437\u0430\u043A\u0430\u0437\u0430"),React.createElement("th",null,"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A"))),React.createElement("tbody",null,Z.competitor.priceHistory.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()).map((e,s)=>React.createElement("tr",{key:s},React.createElement("td",null,new Date(e.date).toLocaleString("ru-RU")),React.createElement("td",null,React.createElement("span",{className:"badge badge-success"},e.price||"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445")),React.createElement("td",null,e.qty!==void 0&&e.qty!==""&&e.qty!==0?React.createElement("span",null,e.qty):React.createElement("span",{className:"text-muted",title:e.qty===void 0?"\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u043B\u0438\u0441\u044C (\u043C\u0435\u043D\u0435\u0435 6 \u0434\u043D\u0435\u0439 \u0441 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0435\u0433\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F)":"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"},"\u2014")),React.createElement("td",null,e.sum!==void 0&&e.sum!==""&&e.sum!==0?React.createElement("span",null,e.sum," \u20BD"):React.createElement("span",{className:"text-muted",title:e.sum===void 0?"\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u043B\u0438\u0441\u044C (\u043C\u0435\u043D\u0435\u0435 6 \u0434\u043D\u0435\u0439 \u0441 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0435\u0433\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F)":"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"},"\u2014")),React.createElement("td",null,e.qty&&e.qty!==""&&e.qty!==0?React.createElement("span",null,e.qty):React.createElement("span",{className:"text-muted"},"\u2014")),React.createElement("td",null,e.sum&&e.sum!==""&&e.sum!==0?React.createElement("span",null,e.sum," \u20BD"):React.createElement("span",{className:"text-muted"},"\u2014")),React.createElement("td",null,React.createElement("span",{className:"badge bg-info text-dark"},e.source)))))),React.createElement("div",{className:"text-muted small mt-2"},"\u0412\u0441\u0435\u0433\u043E \u0437\u0430\u043F\u0438\u0441\u0435\u0439: ",Z.competitor.priceHistory.length)):React.createElement("div",{className:"text-center text-muted py-4"},React.createElement("i",{className:"bi bi-clock-history fs-1 mb-3 d-block"}),React.createElement("p",null,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442"))))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>Ne({competitor:null,productName:""})},"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"))))),t.activeModalSku&&V&&React.createElement("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1040}},React.createElement("div",{className:"modal-dialog modal-xl modal-dialog-scrollable"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header border-bottom"},React.createElement("h5",{className:"modal-title fw-semibold"},"\u0412\u044B\u0431\u043E\u0440 \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u043E\u0432 \u0434\u043B\u044F: ",React.createElement("span",{className:"fw-medium"},ut?.\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430)),React.createElement("button",{type:"button",className:"btn-close",onClick:De})),React.createElement("div",{className:"p-3 border-bottom bg-light-subtle"},(()=>{let e=qe(),s=he(),a=s&&P?at(P):[],n=P?s?_?Ae(P,_):[]:Ae(P):[];return React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"d-flex align-items-center mb-2"},React.createElement("i",{className:"bi bi-award me-2 text-muted"}),React.createElement("span",{className:"text-muted"},"\u0422\u043E\u043F-5 \u0431\u0440\u0435\u043D\u0434\u043E\u0432 \u043F\u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0430\u043C:"),(P||L||_)&&React.createElement("button",{className:"btn btn-sm btn-link text-muted ms-2 p-0",onClick:()=>{W(null),B(null),U(null)}},"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0444\u0438\u043B\u044C\u0442\u0440\u044B")),React.createElement("div",{className:"d-flex flex-wrap gap-2"},e.map((i,o)=>React.createElement("button",{key:i.name,className:`btn btn-sm ${P===i.name?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>{U(P===i.name?null:i.name),B(null),W(null)},style:{fontSize:"14px",fontWeight:P===i.name?"500":"normal"}},React.createElement("span",{className:"badge bg-light text-dark me-1"},"#",o+1),i.name,React.createElement("span",{className:"badge bg-light text-muted ms-1"},i.count," \u043F\u043E\u0437."),React.createElement("span",{className:"badge bg-light text-muted ms-1"},new Intl.NumberFormat("ru-RU",{notation:"compact",compactDisplay:"short"}).format(i.totalSum)," \u20BD"))))),s&&P&&a.length>0&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"d-flex align-items-center mb-2"},React.createElement("i",{className:"bi bi-droplet me-2 text-muted"}),React.createElement("span",{className:"text-muted"},'\u0412\u044F\u0437\u043A\u043E\u0441\u0442\u0438 \u0434\u043B\u044F \u0431\u0440\u0435\u043D\u0434\u0430 "',P,'":')),React.createElement("div",{className:"d-flex flex-wrap gap-2"},a.map(i=>React.createElement("button",{key:i.name,className:`btn btn-sm ${_===i.name?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>{B(_===i.name?null:i.name),W(null)},style:{fontSize:"14px",fontWeight:_===i.name?"500":"normal"}},i.name,React.createElement("span",{className:"badge bg-light text-muted ms-1"},i.count," \u043F\u043E\u0437."))))),P&&n.length>0&&(!s||_)&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"d-flex align-items-center mb-2"},React.createElement("i",{className:"bi bi-box-seam me-2 text-muted"}),React.createElement("span",{className:"text-muted"},"\u041E\u0431\u044A\u0451\u043C\u044B",s&&_?` \u0434\u043B\u044F ${_}`:"",' \u0431\u0440\u0435\u043D\u0434\u0430 "',P,'":')),React.createElement("div",{className:"d-flex flex-wrap gap-2"},n.map(i=>React.createElement("button",{key:i.name,className:`btn btn-sm ${L===i.name?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>{W(L===i.name?null:i.name)},style:{fontSize:"14px",fontWeight:L===i.name?"500":"normal"}},i.name,React.createElement("span",{className:"badge bg-light text-muted ms-1"},i.count," \u043F\u043E\u0437."))))))})(),React.createElement("div",{className:"row g-3"},React.createElement("div",{className:"col-md-8"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-text bg-white border-end-0"},React.createElement("i",{className:"bi bi-search text-muted"})),React.createElement("input",{type:"text",className:"form-control border-start-0",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E, \u0431\u0440\u0435\u043D\u0434\u0443 \u0438\u043B\u0438 SKU...",onChange:e=>{let s=e.target.value.toLowerCase(),a=V;if(!a||a.length<2)return;let n=Y(a);if(n.name===-1||n.link===-1||n.brand===-1||n.qty===-1||n.sum===-1){console.error("\u274C \u041D\u0435 \u0432\u0441\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430:",n);return}if(!s.trim()){y(l=>({...l,searchTerm:"",filteredRows:null}));return}let i=[];for(let l=1;l<a.length;l++){let d=a[l],m=!1;try{if(n.name!==-1&&d[n.name]&&String(d[n.name]).toLowerCase().includes(s)&&(m=!0),!m&&n.brand!==-1&&d[n.brand]&&String(d[n.brand]).toLowerCase().includes(s)&&(m=!0),!m&&n.link!==-1&&d[n.link]){let c=String(d[n.link]),r=ge(c);r&&r.toLowerCase().includes(s)&&(m=!0),!m&&c.toLowerCase().includes(s)&&(m=!0)}m&&i.push(l)}catch(c){console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0435 \u0441\u0442\u0440\u043E\u043A\u0438 ${l}:`,c)}}let o=new Set;z.forEach(l=>{i.includes(l)&&o.add(l)}),y(l=>({...l,searchTerm:s,filteredRows:s?i:null})),T(o)}}))),React.createElement("div",{className:"col-md-4 d-flex justify-content-between align-items-center"},React.createElement("span",{className:"badge bg-light text-dark border"},V.length-1," \u0441\u0442\u0440\u043E\u043A"),React.createElement("div",{className:"text-muted small"},z.size," \u0432\u044B\u0431\u0440\u0430\u043D\u043E")))),React.createElement("div",{className:"modal-body p-0"},React.createElement("div",{className:"table-responsive",style:{maxHeight:"50vh"}},React.createElement("table",{className:"table table-hover table-borderless mb-0"},React.createElement("thead",{className:"sticky-top",style:{top:0,backgroundColor:"#f8f9fa"}},React.createElement("tr",{className:"border-bottom"},React.createElement("th",{style:{width:"50px"},className:"text-center ps-4"},React.createElement("div",{className:"form-check"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:z.size>0&&z.size===ye().length,onChange:e=>{let s=ye();if(e.target.checked){let a=new Set(s);T(a)}else T(new Set)}}))),React.createElement("th",{style:{width:"100px"},className:"fw-semibold"},"\u041E\u0431\u044A\u0451\u043C"),React.createElement("th",{style:{minWidth:"300px"},className:"fw-semibold"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430"),React.createElement("th",{style:{width:"200px"},className:"fw-semibold"},"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u043E\u0432\u0430\u0440"),React.createElement("th",{style:{width:"120px"},className:"fw-semibold"},"\u0411\u0440\u0435\u043D\u0434"),React.createElement("th",{style:{width:"120px"},className:"fw-semibold text-end"},"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E, \u0448\u0442\u0443\u043A\u0438"),React.createElement("th",{style:{width:"150px"},className:"fw-semibold text-end pe-4"},"\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0430 \u0441\u0443\u043C\u043C\u0443, \u20BD"))),React.createElement("tbody",null,ye().map(e=>{let s=V[e],a=z.has(e),n=Y(V);if(n.name===-1||n.link===-1||n.brand===-1||n.qty===-1||n.sum===-1)return console.error("\u274C \u041D\u0435 \u0432\u0441\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u0432 mapping:",n),null;let i=s[n.name]!==void 0?String(s[n.name]).trim():"\u041D\u0435\u0442 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F",o=s[n.link]!==void 0?String(s[n.link]).trim():"#",l=s[n.brand]!==void 0?String(s[n.brand]).trim():"-",d=me(i),m="";if(s[n.qty]!==void 0&&s[n.qty]!==null){let u=s[n.qty];typeof u=="number"?m=new Intl.NumberFormat("ru-RU").format(u):m=String(u).trim()}let c="";if(s[n.sum]!==void 0&&s[n.sum]!==null){let u=s[n.sum];if(typeof u=="number")c=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u)+" \u20BD";else{let p=String(u).trim();c=p?p.includes("\u20BD")?p:p+" \u20BD":""}}let r=ge(o);return React.createElement("tr",{key:e,onClick:()=>st(e),className:`${a?"selected-row":""} border-bottom`},React.createElement("td",{className:"text-center align-middle ps-4"},React.createElement("div",{className:"form-check"},React.createElement("input",{type:"checkbox",className:"form-check-input",checked:a,readOnly:!0,style:{width:"18px",height:"18px"}}))),React.createElement("td",{className:"align-middle"},React.createElement("span",{className:"badge bg-light text-dark border"},d)),React.createElement("td",{className:"align-middle"},React.createElement("div",{className:"d-flex flex-column"},React.createElement("div",{title:i,style:{wordBreak:"break-word"}},i),r&&React.createElement("div",{className:"small text-muted mt-1"},React.createElement("span",{className:"badge bg-light text-dark border"},"SKU: ",r)))),React.createElement("td",{className:"align-middle"},React.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none d-flex align-items-center text-muted",onClick:u=>u.stopPropagation()},React.createElement("span",{className:"text-truncate d-inline-block",style:{maxWidth:"180px"},title:o},o.replace(/^https?:\/\/(www\.)?/,"").split("/")[0]||"\u0421\u0441\u044B\u043B\u043A\u0430"),React.createElement("i",{className:"bi bi-box-arrow-up-right ms-2 small"}))),React.createElement("td",{className:"align-middle"},React.createElement("span",{className:"badge bg-light text-dark border"},l)),React.createElement("td",{className:"align-middle text-end"},m?React.createElement("span",null,m):React.createElement("span",{className:"text-muted"},"\u2014")),React.createElement("td",{className:"align-middle text-end pe-4"},c?React.createElement("span",null,c):React.createElement("span",{className:"text-muted"},"\u2014")))}))))),React.createElement("div",{className:"modal-footer border-top"},React.createElement("div",{className:"d-flex justify-content-between align-items-center w-100"},React.createElement("div",{className:"text-muted small"},"\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E: ",ye().length," \u0438\u0437 ",V.length-1," \u0441\u0442\u0440\u043E\u043A"),React.createElement("div",null,React.createElement("button",{type:"button",className:"btn btn-outline-secondary me-2",onClick:De},"\u041E\u0442\u043C\u0435\u043D\u0430"),React.createElement("button",{type:"button",className:"btn btn-primary",onClick:tt},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u043E\u0435 (",z.size,")"))))))))},xt=yt(document.getElementById("root"));xt.render(React.createElement(St,null));})();
